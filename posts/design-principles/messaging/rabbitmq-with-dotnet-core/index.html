<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.e6020bda5c7287f924bb8f12d78a905d5d6308768ca8fec522a23b043779099f.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Using RabbitMQ with ASP.NET Core</title>
<meta property="og:title" content="Go Sang - Using RabbitMQ with ASP.NET Core"><meta name=twitter:title content="Go Sang - Using RabbitMQ with ASP.NET Core"><meta itemprop=name content="Go Sang - Using RabbitMQ with ASP.NET Core"><meta name=application-name content="Go Sang - Using RabbitMQ with ASP.NET Core"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/design-principles/messaging/rabbitmq-with-dotnet-core/><link rel=canonical href=https://gosang.github.io/posts/design-principles/messaging/rabbitmq-with-dotnet-core/ itemprop=url><meta name=url content="https://gosang.github.io/posts/design-principles/messaging/rabbitmq-with-dotnet-core/"><meta name=twitter:url content="https://gosang.github.io/posts/design-principles/messaging/rabbitmq-with-dotnet-core/"><meta property="og:url" content="https://gosang.github.io/posts/design-principles/messaging/rabbitmq-with-dotnet-core/"><meta property="og:updated_time" content="29006-29-01T658:28:22Z"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="29006-29-01T658:28:22Z"><meta property="article:published_time" content="29006-29-01T658:28:22Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Using RabbitMQ with ASP.NET Core","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2022-06-29","description":"","wordCount":"1149","mainEntityOfPage":"True","dateModified":"2022-06-29","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.122.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/devops/kubernetes/understanding-kubernetes-a-developer-guide/>Understanding Kubernetes: A Developer\`s Guide</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/securing-asp-dotnet-core-web-api-with-oauth-2.0-in-microsoft-entra-id/>Securing ASP.NET Core Web API With OAuth 2.0 in Microsoft Entra ID</a></li><li class=bullet><a href=https://gosang.github.io/posts/datastore/optimistic-concurrency-with-etag-in-asp-dotnet-core-8/>Optimistic Concurrency With Etag in ASP.NET Core 8</a></li><li class=bullet><a href=https://gosang.github.io/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/>Implementing Dapper With ASP.Core 6</a></li><li class=bullet><a href=https://gosang.github.io/posts/datastore/implementing-entity-framework-core-6-with-asp.net-core-6/>Implementing Entity Framework Core 6 With ASP.NET Core 6</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg>
</a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2024 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/design-principles/messaging/rabbitmq-with-dotnet-core/>Using RabbitMQ with ASP.NET Core</a></h1><time datetime=2022-06-29T13:58:28Z class=post-date>June 29, 2022</time><ul class=tags><li class=tag-Microservices><a href=https://gosang.github.io/tags/microservices>Microservices</a></li><li class=tag-Messaging><a href=https://gosang.github.io/tags/messaging>Messaging</a></li></ul><p class=seriesname>Series: <a href=https://gosang.github.io/series/design-principles>Design Principles</a></p></div><p>In the ever-evolving landscape of modern software development, efficient communication between components is crucial. As applications grow in complexity and adopt microservices architecture, a reliable message broker is essential. RabbitMQ, a powerful open-source message broker, has become a cornerstone technology for achieving scalable and robust communication between different parts of an application. In this blog, we will dive deep into RabbitMQ, explain its rationale, explore how it resolves common problems, and demonstrate its usage with ASP.NET Core. We&rsquo;ll also discuss best practices, advantages, and disadvantages of RabbitMQ.</p><h1 id=what-is-rabbitmq>What is RabbitMQ?</h1><p>RabbitMQ is a message broker that allows different parts of your application to communicate by sending and receiving messages. These messages can contain various types of data and can be used for a multitude of purposes, such as distributing work, publishing events, and integrating different systems.</p><h2 id=why-use-rabbitmq>Why use RabbitMQ?</h2><p>The primary rationale behind its usage can be summarized in the following key points:</p><p><strong>1. Decoupling</strong>: RabbitMQ enables the decoupling of components within your application. Instead of components communicating directly, they exchange messages through RabbitMQ. This loose coupling makes it easier to maintain, scale, and evolve your application.</p><p><strong>2. Asynchronous Communication</strong>: By allowing components to communicate asynchronously, RabbitMQ improves the overall responsiveness and throughput of your application. Long-running or resource-intensive tasks can be offloaded without blocking the main application.</p><p><strong>3. Reliability</strong>: RabbitMQ is designed to be highly reliable. It ensures that messages are delivered and processed even in the presence of failures. Messages are safely stored in queues until they are successfully consumed.</p><p><strong>4. Scalability</strong>: RabbitMQ supports both horizontal and vertical scaling, making it a suitable choice for applications that need to grow with increased demand.</p><p><strong>5. Interoperability</strong>: RabbitMQ supports multiple communication protocols and can be used with various programming languages. This enables the integration of disparate systems and technologies.</p><h2 id=what-problems-does-rabbitmq-resolve>What Problems Does RabbitMQ Resolve?</h2><p>RabbitMQ addresses several common problems in application development:</p><p><strong>1. Overload Management</strong>: RabbitMQ helps prevent overloading components by queuing and prioritizing incoming messages. It ensures that work is distributed at a pace the system can handle.</p><p><strong>2. Failure Resilience</strong>: If a component fails, the messages sent to it are not lost. RabbitMQ retains these messages until the component recovers and can process them. This ensures data integrity.</p><p><strong>3. Event-Driven Architectures</strong>: RabbitMQ is an excellent choice for implementing event-driven architectures, where different parts of an application respond to events triggered by other components.</p><p><strong>4. Load Balancing</strong>: It can be used for load balancing across multiple instances of a service. You can use the Round Robin approach to distribute work evenly among the consumers.</p><h1 id=using-rabbitmq-with-aspnet-core>Using RabbitMQ with ASP.NET Core</h1><p>Now, let&rsquo;s explore how to use RabbitMQ in the context of an ASP.NET Core application. We&rsquo;ll use Docker for RabbitMQ, a C# .NET Core Web API, and a repository pattern for demonstrating the concepts.</p><h2 id=setting-up-rabbitmq-with-docker>Setting Up RabbitMQ with Docker</h2><p>To use RabbitMQ with Docker, you can pull the official RabbitMQ image from Docker Hub and run it in a container. Here&rsquo;s a basic Docker Compose file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.7&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rabbitmq</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#34;rabbitmq:3-management&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;15672:15672&#34;</span> <span style=color:#75715e># Web management UI</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5672:5672&#34;</span> <span style=color:#75715e># AMQP port</span>
</span></span></code></pre></div><h2 id=creating-a-net-core-web-api-project>Creating a .NET Core Web API Project</h2><p>Assuming you have ASP.NET Core installed, you can create a new Web API project using the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet new webapi -n MyRabbitMQApp
</span></span></code></pre></div><h2 id=adding-rabbitmq-client-library>Adding RabbitMQ Client Library</h2><p>You need to add the RabbitMQ client library to your ASP.NET Core project. You can do this using NuGet:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package RabbitMQ.Client
</span></span></code></pre></div><h2 id=writing-code>Writing Code</h2><p>Here&rsquo;s a simple example of how to publish a message to RabbitMQ from an ASP.NET Core controller:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> RabbitMQ.Client;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Text;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.AspNetCore.Mvc;
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#a6e22e>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RabbitMQController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult PublishMessage()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> factory = <span style=color:#66d9ef>new</span> ConnectionFactory
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            HostName = <span style=color:#e6db74>&#34;localhost&#34;</span>, <span style=color:#75715e>// RabbitMQ server host</span>
</span></span><span style=display:flex><span>            Port = <span style=color:#ae81ff>5672</span>,            <span style=color:#75715e>// Default RabbitMQ port</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> connection = factory.CreateConnection())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> channel = connection.CreateModel())
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            channel.QueueDeclare(queue: <span style=color:#e6db74>&#34;my_queue&#34;</span>, durable: <span style=color:#66d9ef>false</span>, exclusive: <span style=color:#66d9ef>false</span>, autoDelete: <span style=color:#66d9ef>false</span>, arguments: <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>string</span> message = <span style=color:#e6db74>&#34;Hello, RabbitMQ!&#34;</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> body = Encoding.UTF8.GetBytes(message);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            channel.BasicPublish(exchange: <span style=color:#e6db74>&#34;&#34;</span>, routingKey: <span style=color:#e6db74>&#34;my_queue&#34;</span>, basicProperties: <span style=color:#66d9ef>null</span>, body: body);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;Message sent to RabbitMQ!&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=consuming-messages>Consuming Messages</h2><p>To consume messages, you can create a separate service in your ASP.NET Core application that listens to the RabbitMQ queue, processes messages, and sends responses back to your controllers.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> RabbitMQ.Client;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Text;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.AspNetCore.Mvc;
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#a6e22e>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RabbitMQController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult ConsumeMessage()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> factory = <span style=color:#66d9ef>new</span> ConnectionFactory { HostName = <span style=color:#e6db74>&#34;localhost&#34;</span>, Port = <span style=color:#ae81ff>5672</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> connection = factory.CreateConnection())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> channel = connection.CreateModel())
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            channel.QueueDeclare(queue: <span style=color:#e6db74>&#34;my_queue&#34;</span>, durable: <span style=color:#66d9ef>false</span>, exclusive: <span style=color:#66d9ef>false</span>, autoDelete: <span style=color:#66d9ef>false</span>, arguments: <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> consumer = <span style=color:#66d9ef>new</span> EventingBasicConsumer(channel);
</span></span><span style=display:flex><span>            consumer.Received += (model, ea) =&gt;
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> body = ea.Body.ToArray();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> message = Encoding.UTF8.GetString(body);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                Console.WriteLine(<span style=color:#e6db74>$&#34;Received message: {message}&#34;</span>);
</span></span><span style=display:flex><span>            };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            channel.BasicConsume(queue: <span style=color:#e6db74>&#34;my_queue&#34;</span>, autoAck: <span style=color:#66d9ef>true</span>, consumer: consumer);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;Message consumed from RabbitMQ!&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is a basic setup, and in a real-world scenario, you&rsquo;d want to handle connection management, error handling, and other considerations more robustly.</p><h1 id=advantages-of-rabbitmq>Advantages of RabbitMQ</h1><p>RabbitMQ offers several advantages:</p><ul><li><strong>Reliability</strong>: Messages are not lost, even in the case of system failures.</li><li><strong>Scalability</strong>: It can handle a high volume of messages and can be easily scaled horizontally.</li><li><strong>Message Routing</strong>: RabbitMQ supports routing and filtering of messages based on various criteria.</li><li><strong>Interoperability</strong>: Works well with various programming languages and platforms.</li><li><strong>Community and Support</strong>: Being open-source, RabbitMQ has a large and active community, and there are commercial support options available.</li></ul><h1 id=disadvantages-of-rabbitmq>Disadvantages of RabbitMQ</h1><p>While RabbitMQ is a powerful tool, it&rsquo;s essential to consider its potential drawbacks:</p><ul><li><strong>Complexity</strong>: Setting up and configuring RabbitMQ can be complex, especially for those new to message queuing systems.</li><li><strong>Learning Curve</strong>: Developers may need to invest time in understanding message queuing concepts and RabbitMQ itself.</li><li><strong>Resource Intensive</strong>: Running RabbitMQ can be resource-intensive, so proper infrastructure planning is required for production deployments.</li></ul><h1 id=issues-and-considerations>Issues and Considerations</h1><ul><li><strong>Network Partitioning</strong>: RabbitMQ clusters may face challenges during network partitions, requiring careful configuration.</li><li><strong>Message Serialization</strong>: Ensure proper message serialization to avoid compatibility issues.</li><li><strong>Dead Letter Queues</strong>: Use dead-letter queues to handle messages that couldn&rsquo;t be processed.</li></ul><h1 id=best-practices>Best Practices</h1><p>When using RabbitMQ, consider the following best practices:</p><ul><li><strong>Queue Naming</strong>: Use meaningful names for your queues to improve clarity and maintainability.</li><li><strong>Connection Management</strong>: Reuse connections and channels whenever possible to reduce overhead.</li><li><strong>Error Handling</strong>: Implement robust error handling and retry mechanisms for message processing.</li><li><strong>Monitoring</strong>: Use RabbitMQ management tools to monitor queue activity and troubleshoot issues.</li><li><strong>Security</strong>: Configure RabbitMQ to restrict access to authorized users and hosts.</li><li><strong>Documentation</strong>: Thoroughly document your RabbitMQ setup, including exchanges, queues, and message formats.</li></ul><h1 id=conclusion>Conclusion</h1><p>RabbitMQ is a robust and versatile message broker that can greatly enhance the communication and scalability of your ASP.NET Core applications, whether they are microservices or modular monoliths. It addresses common problems in modern application development and offers a wide range of benefits. By following best practices and recommendations, you can harness the power of RabbitMQ to build reliable and scalable systems.</p><h1 id=references>References</h1><ul><li><a href=https://www.rabbitmq.com/documentation.html target=_blank>RabbitMQ Documentation</a></li><li><a href=https://learn.microsoft.com/en-us/aspnet/core/introduction-to-aspnet-core target=_blank>ASP.NET Core Documentation</a></li></ul><hr><div class=footer><p>This is a post in the <b><a href=https://gosang.github.io/series/design-principles>Design Principles</a></b> series.<br>Other posts in this series:<ul class=series><li>November 1, 2023 -
<a href=/posts/design-principles/microservices/grpc/>gRPC: Revolutionizing Communication in Modern Microservices with .NET Core</a></li><li>August 30, 2023 -
<a href=/posts/design-principles/messaging/implementing-event-bus-with-rabbitmq-in-dotnet-core/>Implementing Event Bus With RabbitMQ in .NET Core</a></li><li>December 5, 2022 -
<a href=/posts/design-principles/feature-flags/>Feature Flags</a></li><li>September 1, 2022 -
<a href=/posts/design-principles/solid/solid/>SOLID Design Principles</a></li><li>August 11, 2022 -
<a href=/posts/design-principles/dry/>DRY Design Principle</a></li><li>June 29, 2022 -
Using RabbitMQ with ASP.NET Core</li><li>April 25, 2022 -
<a href=/posts/design-principles/microservices/idempotency/>Understanding Idempotency in Microservices with .NET Core</a></li><li>April 9, 2022 -
<a href=/posts/design-principles/messaging/apache-kafka-with-dotnet-core/>Apache Kafka With .NET Core</a></li></ul></p></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#why-use-rabbitmq>Why use RabbitMQ?</a></li><li><a href=#what-problems-does-rabbitmq-resolve>What Problems Does RabbitMQ Resolve?</a></li></ul><ul><li><a href=#setting-up-rabbitmq-with-docker>Setting Up RabbitMQ with Docker</a></li><li><a href=#creating-a-net-core-web-api-project>Creating a .NET Core Web API Project</a></li><li><a href=#adding-rabbitmq-client-library>Adding RabbitMQ Client Library</a></li><li><a href=#writing-code>Writing Code</a></li><li><a href=#consuming-messages>Consuming Messages</a></li></ul></nav></div></div></div></body></html>