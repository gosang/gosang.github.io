<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Apache Kafka With .NET Core</title><meta property="og:title" content="Go Sang - Apache Kafka With .NET Core"><meta name=twitter:title content="Go Sang - Apache Kafka With .NET Core"><meta itemprop=name content="Go Sang - Apache Kafka With .NET Core"><meta name=application-name content="Go Sang - Apache Kafka With .NET Core"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/design-principles/messaging/apache-kafka-with-dotnet-core/><link rel=canonical href=https://gosang.github.io/posts/design-principles/messaging/apache-kafka-with-dotnet-core/ itemprop=url><meta name=url content="https://gosang.github.io/posts/design-principles/messaging/apache-kafka-with-dotnet-core/"><meta name=twitter:url content="https://gosang.github.io/posts/design-principles/messaging/apache-kafka-with-dotnet-core/"><meta property="og:url" content="https://gosang.github.io/posts/design-principles/messaging/apache-kafka-with-dotnet-core/"><meta property="og:updated_time" content="9004-09-01T458:28:22Z"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="9004-09-01T458:28:22Z"><meta property="article:published_time" content="9004-09-01T458:28:22Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Apache Kafka With .NET Core","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2022-04-09","description":"","wordCount":"1805","mainEntityOfPage":"True","dateModified":"2022-04-09","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/react/zustand-redux-context-choosing-the-right-state-management-solution/>Zustand, Redux and Context: Choosing the Right State Management Solution</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/javascript-security-risks-and-best-practices-for-mitigation/>JavaScript Security Risks and Best Practices for Mitigation</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/understanding-memory-leaks-in-javascript-and-how-to-prevent-them/>Understanding Memory Leaks in JavaScript and How to Prevent Them</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/error-handling-in-nextjs-with-typescript/>Error Handling in Next.js With TypeScript</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/callback-promise-async-await-in-javascript/>Callback Promise Async Await in Javascript</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2025 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/design-principles/messaging/apache-kafka-with-dotnet-core/>Apache Kafka With .NET Core</a></h1><time datetime=2022-04-09T13:58:28Z class=post-date>April 9, 2022</time><ul class=tags><li class=tag-Microservices><a href=https://gosang.github.io/tags/microservices>Microservices</a></li><li class=tag-Messaging><a href=https://gosang.github.io/tags/messaging>Messaging</a></li><li class="tag-Event-driven architecture"><a href=https://gosang.github.io/tags/event-driven-architecture>Event-driven architecture</a></li></ul><p class=seriesname>Series: <a href=https://gosang.github.io/series/design-principles>Design Principles</a></p></div><h1 id=introduction>Introduction</h1><p>Apache Kafka has emerged as a game-changer in the realm of distributed systems, offering a robust and scalable solution for building event-driven architectures. In this technical blog, we will look into the intricacies of Apache Kafka, exploring its core concepts, implementation in a .NET Core e-commerce system, and discussing the advantages, disadvantages, issues, and best practices associated with its use.</p><h1 id=understanding-apache-kafka>Understanding Apache Kafka</h1><h2 id=what-is-apache-kafka>What is Apache Kafka?</h2><p>Apache Kafka is a distributed streaming platform that excels at handling real-time data feeds and creating scalable, fault-tolerant, and high-throughput messaging systems. Born out of the need for efficiently handling massive amounts of data at LinkedIn, Kafka has evolved into an open-source powerhouse, providing a unified solution for distributed event processing.</p><h2 id=why-kafka>Why Kafka?</h2><p>The rationale for Kafka lies in addressing challenges posed by real-time data processing in large-scale distributed environments. It acts as a bridge, connecting disparate components and enabling seamless communication, making it an ideal choice for scenarios where traditional messaging systems fall short.</p><h2 id=problems-resolved-by-kafka>Problems Resolved by Kafka</h2><ul><li><strong>Scalability</strong>: Kafka&rsquo;s distributed architecture allows it to scale horizontally, ensuring it can handle large volumes of data and high throughput.</li><li><strong>Reliability</strong>: Kafka guarantees fault tolerance by replicating data across multiple nodes, ensuring that even if a node fails, the system continues to function.</li><li><strong>Real-time Processing</strong>: Kafka&rsquo;s ability to process events in real-time makes it suitable for scenarios requiring low-latency communication and immediate data updates.</li></ul><h1 id=kafka-in-action-net-core-e-commerce-system>Kafka in Action: .NET Core E-Commerce System</h1><p>Let&rsquo;s dive into a practical example of implementing an event-driven architecture using Apache Kafka in the context of a .NET Core e-commerce system.</p><h2 id=net-core-services-and-apis>.NET Core Services and APIs</h2><p>Our e-commerce system is built using .NET Core, leveraging the MediatR library for implementing the Command Query Responsibility Segregation (CQRS) pattern. AutoMapper facilitates seamless object-to-object mapping, and EF Core InMemory database ensures efficient data management. Unit tests are handled using xUnit.</p><h2 id=event-driven-architecture-with-kafka>Event-Driven Architecture with Kafka</h2><p>In an event-driven architecture using Apache Kafka, the key components are the Event Producer, Event Consumer, and the Event Bus. Let&rsquo;s look into each of these elements to understand their roles in facilitating seamless communication within a distributed system.</p><h3 id=event-producer>Event Producer</h3><p>The Event Producer is responsible for initiating and publishing events to the Kafka cluster. In the context of our e-commerce system, consider scenarios where events such as &ldquo;Order Placed,&rdquo; &ldquo;Inventory Updated,&rdquo; or &ldquo;Payment Confirmed&rdquo; occur. The Event Producer, implemented using C# .NET Core, sends these events to specific Kafka topics.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Example of an Event Producer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderPlacedEventProducer</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IKafkaProducer _kafkaProducer;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> OrderPlacedEventProducer(IKafkaProducer kafkaProducer)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _kafkaProducer = kafkaProducer;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task PublishOrderPlacedEvent(OrderPlacedEvent orderEvent)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> _kafkaProducer.ProduceAsync(<span style=color:#e6db74>&#34;order-placed-topic&#34;</span>, orderEvent);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this example, the <code>OrderPlacedEventProducer</code> encapsulates the logic for publishing an &ldquo;Order Placed&rdquo; event to the &ldquo;order-placed-topic&rdquo; Kafka topic. The use of a dedicated producer for each event type ensures a modular and maintainable design.</p><h3 id=event-consumer>Event Consumer</h3><p>On the other side of the spectrum, the Event Consumer listens for and processes events from Kafka topics. In the e-commerce system, the Event Consumer is designed to react to events like &ldquo;Order Placed&rdquo; and initiate actions such as updating inventory or sending notifications.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Example of an Event Consumer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderPlacedEventHandler</span> : INotificationHandler&lt;OrderPlacedEvent&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Handle(OrderPlacedEvent notification, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Handle the order placed event, update inventory, send notifications, etc.</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here, the <code>OrderPlacedEventHandler</code> is a consumer designed to handle the &ldquo;Order Placed&rdquo; event. The <code>INotificationHandler</code> interface, part of the MediatR library, facilitates the decoupling of event handlers, promoting a modular and extensible architecture.</p><h3 id=event-bus>Event Bus</h3><p>The Event Bus serves as the backbone of the event-driven architecture, acting as the communication channel between the Event Producers and Consumers. In the context of Kafka, the Event Bus is realized through Kafka topics, which act as message queues where events are published and consumed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Example of Kafka Consumer Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> consumerConfig = <span style=color:#66d9ef>new</span> ConsumerConfig
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    BootstrapServers = <span style=color:#e6db74>&#34;localhost:9092&#34;</span>,
</span></span><span style=display:flex><span>    GroupId = <span style=color:#e6db74>&#34;order-service-group&#34;</span>,
</span></span><span style=display:flex><span>    AutoOffsetReset = AutoOffsetReset.Earliest
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example of Kafka Consumer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> consumerBuilder = <span style=color:#66d9ef>new</span> ConsumerBuilder&lt;Ignore, <span style=color:#66d9ef>string</span>&gt;(consumerConfig);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> consumer = consumerBuilder.Build();
</span></span><span style=display:flex><span>consumer.Subscribe(<span style=color:#e6db74>&#34;order-placed-topic&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> (<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> consumeResult = consumer.Consume();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Process the consumed event</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this Kafka Consumer example, a consumer is configured to subscribe to the &ldquo;order-placed-topic.&rdquo; The continuous loop ensures that the consumer is always listening for new events. As events arrive on the topic, the consumer processes and reacts to them, forming the core of the event-driven communication.</p><h2 id=local-environment-setup>Local Environment Setup</h2><h3 id=net-core-api-project>.NET Core API Project</h3><ol><li>Create a new .NET Core API project using the following command:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dotnet new web -n ECommerceApi
</span></span></code></pre></div><ol start=2><li>Add necessary dependencies using the Confluent.Kafka, SchemaRegistry, MediatR and AutoMapper NuGet packages.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dotnet add package Confluent.Kafka --version 2.3.0
</span></span><span style=display:flex><span>dotnet add package Confluent.SchemaRegistry.Serdes.Avro --version 2.3.0
</span></span><span style=display:flex><span>dotnet add package Confluent.SchemaRegistry.Serdes.Json --version 2.3.0
</span></span><span style=display:flex><span>dotnet add package Confluent.SchemaRegistry --version 2.3.0
</span></span><span style=display:flex><span>dotnet add package MediatR
</span></span><span style=display:flex><span>dotnet add package AutoMapper.Extensions.Microsoft.DependencyInjection
</span></span><span style=display:flex><span>dotnet add package xunit
</span></span></code></pre></div><ol start=3><li>Docker Compose YAML</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.8&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ecommerce-api</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>ECommerceApi/Dockerfile</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5000:5000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>kafdrop</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>schema-registry</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kafka</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>wurstmeister/kafka:2.13-2.8.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;9092:9092&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>KAFKA_ADVERTISED_LISTENERS</span>: <span style=color:#ae81ff>INSIDE://kafka:9093,OUTSIDE://localhost:9092</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span>: <span style=color:#ae81ff>INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>KAFKA_LISTENERS</span>: <span style=color:#ae81ff>INSIDE://0.0.0.0:9093,OUTSIDE://0.0.0.0:9092</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>KAFKA_INTER_BROKER_LISTENER_NAME</span>: <span style=color:#ae81ff>INSIDE</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>KAFKA_ZOOKEEPER_CONNECT</span>: <span style=color:#ae81ff>zookeeper:2181</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/run/docker.sock:/var/run/docker.sock</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>zookeeper</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>wurstmeister/zookeeper:3.4.6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;2181:2181&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kafdrop</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>obsidiandynamics/kafdrop:3.27.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;9000:9000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>KAFKA_BROKERCONNECT</span>: <span style=color:#ae81ff>kafka:9093</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>schema-registry</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>confluentinc/cp-schema-registry:7.1.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8081:8081&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>SCHEMA_REGISTRY_KAFKASTORE_CONNECTION_URL</span>: <span style=color:#e6db74>&#34;zookeeper:2181&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SCHEMA_REGISTRY_HOST_NAME</span>: <span style=color:#ae81ff>schema-registry</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SCHEMA_REGISTRY_LISTENERS</span>: <span style=color:#e6db74>&#34;http://0.0.0.0:8081&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>SCHEMA_REGISTRY_AVRO_COMPATIBILITY_LEVEL</span>: <span style=color:#e6db74>&#34;full&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>kafka</span>
</span></span></code></pre></div><ul><li><strong>Apache Zookeeper</strong>: Apache ZooKeeper is a distributed coordination service essential for maintaining configuration information, naming, providing distributed synchronization, and group services. Kafka relies on ZooKeeper for distributed coordination among its broker nodes, managing topics, and handling leader election for partitions.</li><li><strong>Apache Kafka</strong>: Apache Kafka is a distributed streaming platform that enables the building of real-time data pipelines and streaming applications. It acts as a durable, fault-tolerant publish-subscribe messaging system, handling high-throughput data streams. Kafka is structured around topics, partitions, producers, and consumers, providing scalability and fault tolerance.</li><li><strong>Kafdrop</strong>: Kafdrop is a web-based UI for monitoring Apache Kafka clusters. It offers insights into topics, partitions, and messages, making it a valuable tool for visualizing the state of Kafka topics and consumer groups. Kafdrop simplifies Kafka cluster management and enhances visibility for developers and administrators.</li><li><strong>Schema Registry, Avro Schema, and Avrogen</strong>:<ul><li><strong>Avro Schema</strong>: Avro is a binary serialization format used by Kafka for efficient and compact data representation. Avro schemas define the structure of the data being exchanged. They provide a way to encode and decode messages uniformly, ensuring compatibility across different systems and programming languages.</li><li><strong>Avrogen</strong>: Avrogen is a tool that generates Avro serialization and deserialization code based on Avro schema files. It simplifies the integration of Avro with programming languages by creating language-specific classes and methods for working with Avro data. Avrogen aids in maintaining a consistent data format between producers and consumers in a Kafka ecosystem.</li><li><strong>Schema Registry</strong>: The Schema Registry is a critical component in a Kafka ecosystem using Avro. It centralizes the storage and management of Avro schemas, ensuring that producers and consumers share a common schema for data serialization. This guarantees schema evolution without breaking existing systems. The Schema Registry provides RESTful APIs for schema registration, retrieval, and compatibility checks.</li></ul></li></ul><h2 id=running-and-debugging-docker-compose-and-the-project>Running and Debugging Docker Compose and the Project</h2><p>Steps for Running Docker Compose:</p><ol><li><p>Ensure Docker Desktop is installed and running on your machine.</p></li><li><p>Open a terminal and navigate to the directory containing your <code>docker-compose.yaml</code> file.</p></li><li><p>Run the following command to start the services defined in the Docker Compose file:</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><ol start=4><li>To view the logs of the running services, use:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker-compose logs -f
</span></span></code></pre></div><h3 id=steps-for-running-and-debugging-the-net-core-project>Steps for Running and Debugging the .NET Core Project:</h3><ol><li><p>Ensure you have the latest version of the .NET Core SDK installed.</p></li><li><p>Open a terminal and navigate to the root directory of your .NET Core project.</p></li><li><p>Build the project using:</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dotnet build
</span></span></code></pre></div><ol start=4><li>Run the project:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dotnet run --project ECommerceApi/
</span></span><span style=display:flex><span>ECommerceApi.csproj
</span></span></code></pre></div><ol start=5><li><p>Access the API at <code>http://localhost:5000</code> in your web browser or a tool like Postman.</p></li><li><p>For debugging, use Visual Studio Code or Visual Studio. Set breakpoints, inspect variables, and step through the code to identify and fix issues.</p></li><li><p>To stop the Docker Compose services, use:</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker-compose down
</span></span></code></pre></div><ol start=8><li>To clean up containers, networks, and volumes, use:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker-compose down -v
</span></span></code></pre></div><p>By following these steps, you can run and debug both the Docker Compose environment and the .NET Core project effectively. This ensures a smooth development and testing experience for your Kafka-based e-commerce system.</p><h1 id=advantages-and-disadvantages-of-apache-kafka>Advantages and Disadvantages of Apache Kafka</h1><h2 id=advantages>Advantages</h2><ul><li><strong>Scalability</strong>: Kafka scales horizontally, handling increased load by adding more nodes to the cluster.</li><li><strong>Reliability</strong>: Data replication ensures fault tolerance, making Kafka highly reliable.</li><li><strong>Real-time Processing</strong>: Kafka processes events in real-time, making it suitable for low-latency applications.</li><li><strong>Durable Storage</strong>: Kafka provides durable storage of events, allowing historical data retrieval.</li></ul><h2 id=disadvantages>Disadvantages</h2><ul><li><strong>Complexity</strong>: Setting up and managing a Kafka cluster can be complex, especially for beginners.</li><li><strong>Resource Intensive</strong>: Kafka may require substantial resources, particularly in terms of storage and memory.</li><li><strong>Learning Curve</strong>: Developers unfamiliar with event-driven architectures may face a learning curve when adopting Kafka.</li></ul><h1 id=issues-and-considerations>Issues and Considerations</h1><ul><li><strong>Schema Evolution</strong>: Ensuring compatibility during schema evolution is crucial when using Kafka, and the Schema Registry plays a key role in managing schema changes.</li><li><strong>Monitoring and Operations</strong>: Proper monitoring tools are necessary to ensure the health and performance of the Kafka cluster.</li><li><strong>Security Considerations</strong>: Implementing authentication, authorization, and encryption mechanisms is vital to securing the Kafka cluster.</li></ul><h1 id=when-to-use-and-when-not-to-use-kafka>When to Use and When Not to Use Kafka</h1><p>Use Cases/Scenarios</p><ul><li><strong>Event-Driven Microservices</strong>: Kafka is ideal for microservices architectures that rely on event-driven communication patterns.</li><li><strong>Real-Time Analytics</strong>: Applications requiring real-time analytics and insights benefit from Kafka&rsquo;s ability to process events as they occur.</li><li><strong>Log Aggregation</strong>: Kafka serves as a robust solution for log aggregation, collecting and centralizing logs from various services.</li></ul><p>When Not to Use Kafka</p><ul><li><strong>Simple Point-to-Point Communication</strong>: For straightforward, point-to-point communication, simpler messaging systems like RabbitMQ may be more suitable.</li><li><strong>Small-Scale Applications</strong>: In scenarios where the complexity of setting up and managing Kafka outweighs the benefits, simpler solutions may be more practical.</li></ul><h1 id=best-practices>Best Practices</h1><ul><li><strong>Topic Naming Conventions</strong>: Adopt a clear and consistent naming convention for Kafka topics, reflecting the nature of the events they represent.</li><li><strong>Data Serialization</strong>: Use efficient serialization formats (Avro, Protobuf) to optimize data transfer and storage.</li><li><strong>Partitioning Strategies</strong>: Choose appropriate partitioning strategies to ensure even distribution of data across Kafka brokers.</li><li><strong>Monitoring and Metrics</strong>: Implement monitoring tools to track Kafka cluster health, performance, and consumer lag.</li><li><strong>Security Considerations</strong>: Secure your Kafka cluster using authentication, authorization, and encryption mechanisms.</li></ul><h1 id=conclusion>Conclusion</h1><p>Apache Kafka stands as a powerful solution for building scalable, real-time event-driven architectures. In this blog, we explored its fundamentals, walked through a practical .NET Core implementation for an e-commerce system, discussed advantages, disadvantages, issues, and provided best practices. By leveraging Kafka&rsquo;s capabilities, developers can build resilient and efficient systems that thrive in the world of distributed computing.</p><h1 id=references>References</h1><ul><li><a href=https://kafka.apache.org/documentation.html target=_blank>Apache Kafka documentation</a></li><li><a href=https://cwiki.apache.org/confluence/display/ZOOKEEPER/Index target=_blank>Zookeeper documentation</a></li><li><a href=https://cwiki.apache.org/confluence/display/KAFKA/A+Guide+To+The+Kafka+Protocol target=_blank>Kafka client protocol</a></li><li><a href=https://docs.confluent.io/kafka-clients/dotnet/current/overview.html target=_blank>Apache Kafka .NET Client</a></li><li><a href=https://learn.microsoft.com/en-us/azure/event-hubs/apache-kafka-developer-guide target=_blank>Apache Kafka developer guide for Azure Event Hubs</a></li><li><a href=https://github.com/confluentinc/confluent-kafka-dotnet target=_blank>Confluent Kafka Dotnet</a></li><li><a href=https://learn.microsoft.com/en-us/azure/event-hubs/apache-kafka-developer-guide target=_blank>Apache Kafka developer guide for Azure Event Hubs</a></li></ul><hr><div class=footer><p>This is a post in the <b><a href=https://gosang.github.io/series/design-principles>Design Principles</a></b> series.<br>Other posts in this series:<ul class=series><li>November 1, 2023 -
<a href=/posts/design-principles/microservices/grpc/>gRPC: Revolutionizing Communication in Modern Microservices with .NET Core</a></li><li>August 30, 2023 -
<a href=/posts/design-principles/messaging/implementing-event-bus-with-rabbitmq-in-dotnet-core/>Implementing Event Bus With RabbitMQ in .NET Core</a></li><li>December 5, 2022 -
<a href=/posts/design-principles/feature-flags/>Feature Flags</a></li><li>September 1, 2022 -
<a href=/posts/design-principles/solid/solid/>SOLID Design Principles</a></li><li>August 11, 2022 -
<a href=/posts/design-principles/dry/>DRY Design Principle</a></li><li>June 29, 2022 -
<a href=/posts/design-principles/messaging/rabbitmq-with-dotnet-core/>Using RabbitMQ with ASP.NET Core</a></li><li>April 25, 2022 -
<a href=/posts/design-principles/microservices/idempotency/>Understanding Idempotency in Microservices with .NET Core</a></li><li>April 9, 2022 -
Apache Kafka With .NET Core</li></ul></p></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#what-is-apache-kafka>What is Apache Kafka?</a></li><li><a href=#why-kafka>Why Kafka?</a></li><li><a href=#problems-resolved-by-kafka>Problems Resolved by Kafka</a></li></ul><ul><li><a href=#net-core-services-and-apis>.NET Core Services and APIs</a></li><li><a href=#event-driven-architecture-with-kafka>Event-Driven Architecture with Kafka</a><ul><li><a href=#event-producer>Event Producer</a></li><li><a href=#event-consumer>Event Consumer</a></li><li><a href=#event-bus>Event Bus</a></li></ul></li><li><a href=#local-environment-setup>Local Environment Setup</a><ul><li><a href=#net-core-api-project>.NET Core API Project</a></li></ul></li><li><a href=#running-and-debugging-docker-compose-and-the-project>Running and Debugging Docker Compose and the Project</a><ul><li><a href=#steps-for-running-and-debugging-the-net-core-project>Steps for Running and Debugging the .NET Core Project:</a></li></ul></li></ul><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li></ul></nav></div></div></div></body></html>