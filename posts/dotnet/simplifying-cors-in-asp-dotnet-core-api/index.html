<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Simplifying CORS in ASP.NET Core API</title><meta property="og:title" content="Go Sang - Simplifying CORS in ASP.NET Core API"><meta name=twitter:title content="Go Sang - Simplifying CORS in ASP.NET Core API"><meta itemprop=name content="Go Sang - Simplifying CORS in ASP.NET Core API"><meta name=application-name content="Go Sang - Simplifying CORS in ASP.NET Core API"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/><link rel=canonical href=https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/ itemprop=url><meta name=url content="https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/"><meta name=twitter:url content="https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/"><meta property="og:url" content="https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/"><meta property="og:updated_time" content="22007-22-10T743:37:24+0100"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="22007-22-10T743:37:24+0100"><meta property="article:published_time" content="22007-22-10T743:37:24+0100"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Simplifying CORS in ASP.NET Core API","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2024-07-22","description":"","wordCount":"1081","mainEntityOfPage":"True","dateModified":"2024-07-22","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-range-based-pagination-with-mongodb-csharp-driver-in-asp-dotnet-core/>Implementing Range-Based Pagination with MongoDB C# Driver in ASP.NET Core 8</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-pagination-with-mongodb-csharp-driver-in-asp-dotnet-core/>Implementing Pagination with MongoDB C# Driver in ASP.NET Core 8</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/zustand-redux-context-choosing-the-right-state-management-solution/>Zustand, Redux and Context: Choosing the Right State Management Solution</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/javascript-security-risks-and-best-practices-for-mitigation/>JavaScript Security Risks and Best Practices for Mitigation</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/understanding-memory-leaks-in-javascript-and-how-to-prevent-them/>Understanding Memory Leaks in JavaScript and How to Prevent Them</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2025 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/>Simplifying CORS in ASP.NET Core API</a></h1><time datetime=2024-07-22T10:43:37+0100 class=post-date>July 22, 2024</time><ul class=tags><li class="tag-.NET Core"><a href=https://gosang.github.io/tags/.net-core>.NET Core</a></li><li class=tag-CORS><a href=https://gosang.github.io/tags/cors>CORS</a></li></ul></div><p>Cross-Origin Resource Sharing (CORS) is a fundamental concept in web development, especially when dealing with APIs. This blog post explores CORS in an ASP.NET Core API, covering what it is, why it&rsquo;s essential, and how to implement it effectively.</p><h1 id=what-is-cors>What is CORS?</h1><p>CORS stands for Cross-Origin Resource Sharing. It is a security feature implemented by browsers to control how resources on a web server can be requested from another domain. This prevents malicious websites from making unauthorized requests to another domain.</p><h2 id=why-cors>Why CORS?</h2><p>Modern web applications often need to interact with resources from different origins. For example, a frontend application hosted at <a href=http://example.com target=_blank>http://example.com</a> may need to request data from an API at <a href=http://api.example.com target=_blank>http://api.example.com</a>. Browsers implement the Same-Origin Policy (SOP) to enhance security, which restricts web pages from making requests to a different origin. CORS provides a way to relax these restrictions securely.</p><h2 id=problems-resolved-by-cors>Problems Resolved by CORS</h2><p>CORS resolves the issue of securely allowing a web application to make requests to a different origin. Without CORS, modern web applications would be limited in their ability to interact with APIs and services located on different domains, restricting functionality and integration possibilities.</p><h2 id=what-is-a-preflight-request>What is a Preflight Request?</h2><p>A preflight request is an initial request made by the browser using the HTTP OPTIONS method to determine if the actual request is safe to send. This happens particularly with requests that might affect user data (e.g., requests other than GET, or POST requests with certain headers). The server&rsquo;s response to this preflight request indicates whether the actual request is allowed.</p><h1 id=enabling-cors-in-an-aspnet-core-api>Enabling CORS in an ASP.NET Core API</h1><p>Enabling CORS in an ASP.NET Core API involves configuring middleware in your <code>Startup.cs</code> file. Below is a step-by-step guide:</p><h2 id=step-1-install-the-cors-nuget-package>Step 1: Install the CORS NuGet Package</h2><p>If not already included, install the CORS package:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package Microsoft.AspNetCore.Cors
</span></span></code></pre></div><h2 id=step-2-configure-cors-in-startupcs-using-appsettingsjson>Step 2: Configure CORS in Startup.cs using appsettings.json</h2><p>First, add the CORS settings in the <code>appsettings.json</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;CorsSettings&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedOrigins&#34;</span>: [<span style=color:#e6db74>&#34;http://example.com&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedMethods&#34;</span>: [<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;DELETE&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedHeaders&#34;</span>: [<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;Authorization&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, modify the <code>Startup.cs</code> file to read these settings and configure CORS accordingly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Startup</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IConfiguration Configuration { <span style=color:#66d9ef>get</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Startup(IConfiguration configuration)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Configuration = configuration;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> corsSettings = Configuration.GetSection(<span style=color:#e6db74>&#34;CorsSettings&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> allowedOrigins = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedOrigins&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> allowedMethods = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedMethods&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> allowedHeaders = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedHeaders&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        services.AddCors(options =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            options.AddPolicy(<span style=color:#e6db74>&#34;DefaultCorsPolicy&#34;</span>,
</span></span><span style=display:flex><span>                builder =&gt; builder.WithOrigins(allowedOrigins)
</span></span><span style=display:flex><span>                                  .WithMethods(allowedMethods)
</span></span><span style=display:flex><span>                                  .WithHeaders(allowedHeaders));
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        services.AddControllers();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        app.UseRouting();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        app.UseCors(<span style=color:#e6db74>&#34;DefaultCorsPolicy&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        app.UseEndpoints(endpoints =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            endpoints.MapControllers();
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=enabling-cors-in-net-8-api>Enabling CORS in .NET 8 API</h2><p>With .NET 8&rsquo;s minimal API approach, enabling CORS using settings from <code>appsettings.json</code> looks slightly different:</p><h3 id=step-1-add-the-cors-settings-in-appsettingsjson>Step 1: Add the CORS settings in appsettings.json</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;CorsSettings&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedOrigins&#34;</span>: [<span style=color:#e6db74>&#34;http://example.com&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedMethods&#34;</span>: [<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;POST&#34;</span>, <span style=color:#e6db74>&#34;PUT&#34;</span>, <span style=color:#e6db74>&#34;DELETE&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedHeaders&#34;</span>: [<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;Authorization&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=step-2-modify-programcs>Step 2: Modify Program.cs</h3><p>Modify the <code>Program.cs</code> file to read the CORS settings and configure CORS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Read CORS settings from appsettings.json</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> corsSettings = builder.Configuration.GetSection(<span style=color:#e6db74>&#34;CorsSettings&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> allowedOrigins = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedOrigins&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> allowedMethods = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedMethods&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> allowedHeaders = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedHeaders&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add CORS services</span>
</span></span><span style=display:flex><span>builder.Services.AddCors(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.AddPolicy(<span style=color:#e6db74>&#34;DefaultCorsPolicy&#34;</span>,
</span></span><span style=display:flex><span>        policy =&gt; policy.WithOrigins(allowedOrigins)
</span></span><span style=display:flex><span>                        .WithMethods(allowedMethods)
</span></span><span style=display:flex><span>                        .WithHeaders(allowedHeaders));
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.AddControllers();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use CORS middleware</span>
</span></span><span style=display:flex><span>app.UseCors(<span style=color:#e6db74>&#34;DefaultCorsPolicy&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.MapControllers();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><h2 id=controlling-access-with-cors-headers>Controlling Access with CORS Headers</h2><p>You can control access using various CORS headers such as <code>Access-Control-Allow-Origin</code>, <code>Access-Control-Allow-Methods</code>, <code>Access-Control-Allow-Headers</code>, and <code>Access-Control-Allow-Credentials</code>.</p><p>For example, to allow multiple origins and restrict methods:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;CorsSettings&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedOrigins&#34;</span>: [<span style=color:#e6db74>&#34;http://example1.com&#34;</span>, <span style=color:#e6db74>&#34;http://example2.com&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedMethods&#34;</span>: [<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;POST&#34;</span>],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;AllowedHeaders&#34;</span>: [<span style=color:#e6db74>&#34;Content-Type&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=sample-net-core-8-api-project>Sample .NET Core 8 API Project</h1><p>Let&rsquo;s create a sample .NET Core 8 API project demonstrating CORS configuration.</p><h2 id=step-1-create-a-new-project>Step 1: Create a New Project</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet new webapi -n CorsSampleApi
</span></span><span style=display:flex><span>cd CorsSampleApi
</span></span></code></pre></div><h2 id=step-2-modify-programcs-to-use-settings-from-appsettingsjson>Step 2: Modify Program.cs to use settings from appsettings.json</h2><p>Modify the <code>Program.cs</code> file to read the CORS settings and configure CORS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Read CORS settings from appsettings.json</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> corsSettings = builder.Configuration.GetSection(<span style=color:#e6db74>&#34;CorsSettings&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> allowedOrigins = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedOrigins&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> allowedMethods = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedMethods&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> allowedHeaders = corsSettings.GetSection(<span style=color:#e6db74>&#34;AllowedHeaders&#34;</span>).Get&lt;<span style=color:#66d9ef>string</span>[]&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Add CORS services</span>
</span></span><span style=display:flex><span>builder.Services.AddCors(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.AddPolicy(<span style=color:#e6db74>&#34;DefaultCorsPolicy&#34;</span>,
</span></span><span style=display:flex><span>        policy =&gt; policy.WithOrigins(allowedOrigins)
</span></span><span style=display:flex><span>                        .WithMethods(allowedMethods)
</span></span><span style=display:flex><span>                        .WithHeaders(allowedHeaders));
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.AddControllers();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Use CORS middleware</span>
</span></span><span style=display:flex><span>app.UseCors(<span style=color:#e6db74>&#34;DefaultCorsPolicy&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.MapControllers();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><h2 id=step-3-add-a-sample-controller>Step 3: Add a Sample Controller</h2><p>Create a simple controller to test CORS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.AspNetCore.Mvc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> CorsSampleApi.Controllers
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [Route(&#34;[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TestController</span> : ControllerBase
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [HttpGet]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> IActionResult Get()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;CORS is enabled!&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=step-4-run-the-application>Step 4: Run the Application</h2><p>Run the application and test CORS using a frontend application or tools like Postman.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet run
</span></span></code></pre></div><h1 id=advantages-and-disadvantages-of-cors>Advantages and Disadvantages of CORS</h1><h2 id=advantages>Advantages</h2><ul><li><strong>Security</strong>: Enhances security by restricting resource access to specified origins.</li><li><strong>Flexibility</strong>: Easily configurable to meet various requirements.</li><li><strong>Interoperability</strong>: Enables interaction between different domains, facilitating integration of multiple services.</li></ul><h2 id=disadvantages>Disadvantages</h2><ul><li><strong>Complexity</strong>: Configuring CORS can be complex and error-prone.</li><li><strong>Performance</strong>: Preflight requests can add latency to the application.</li><li><strong>Maintenance</strong>: Keeping CORS configurations updated can require ongoing effort.</li></ul><h1 id=when-to-use-and-when-not-to-use-cors>When to Use and When Not to Use CORS</h1><h2 id=when-to-use-cors>When to Use CORS</h2><ul><li><strong>Cross-Domain Requests</strong>: When your application needs to access resources from a different domain.</li><li><strong>API Exposure</strong>: When you want to expose your API to specific external clients.</li><li><strong>Third-Party Integrations</strong>: When integrating with third-party services that require cross-origin requests.</li></ul><h2 id=when-not-to-use-cors>When Not to Use CORS</h2><ul><li><strong>Same-Domain Requests</strong>: When all requests are within the same domain, CORS is unnecessary.</li><li><strong>Highly Sensitive Data</strong>: For APIs handling highly sensitive data, consider stricter security measures.</li><li><strong>Internal APIs</strong>: For internal APIs used only within a secured network, CORS might not be required.</li></ul><h1 id=issues-considerations-and-best-practices>Issues, Considerations, and Best Practices</h1><h2 id=issues>Issues</h2><ul><li><strong>Misconfiguration</strong>: Incorrect CORS settings can lead to security vulnerabilities.</li><li><strong>Debugging</strong>: Diagnosing CORS issues can be challenging due to lack of detailed error messages.</li><li><strong>Browser Support</strong>: While widely supported, older browsers may not fully support CORS.</li></ul><h2 id=considerations>Considerations</h2><ul><li><strong>Least Privilege</strong>: Configure CORS to allow the least privilege necessary.</li><li><strong>Testing</strong>: Thoroughly test CORS configurations across different environments.</li><li><strong>Documentation</strong>: Keep detailed documentation of your CORS settings for maintenance and troubleshooting.</li></ul><h2 id=best-practices>Best Practices</h2><ul><li><strong>Use Specific Origins</strong>: Avoid using AllowAnyOrigin. Specify exact origins that are allowed.</li><li><strong>Restrict Methods and Headers</strong>: Only allow the necessary methods and headers.</li><li><strong>Review and Update Regularly</strong>: Regularly review and update your CORS settings to ensure they meet current security standards and requirements.</li></ul><h1 id=conclusion>Conclusion</h1><p>CORS is an essential feature for web security, enabling secure cross-origin requests while maintaining the flexibility necessary for modern web applications. By carefully configuring and maintaining CORS in your ASP.NET Core API, you can enhance both security and functionality, ensuring your applications can safely interact with a wide range of services and clients.</p><p>By understanding and implementing best practices for CORS, developers can create secure, robust, and flexible web applications.</p><h1 id=references>References</h1><ul><li><a href="https://docs.microsoft.com/en-us/aspnet/core/security/cors?view=aspnetcore-6.0" target=_blank>ASP.NET Core documentation on CORS</a>.</li></ul><hr><div class=footer><a class=previous-post href="https://gosang.github.io/posts/dotnet/using-hangfire-with-asp-dotnet-core-and-worker-services/?ref=footer"><span style=font-weight:700>« Previous</span><br>Using Hangfire with ASP.NET Core and Worker...</a><div class=next-post><a href="https://gosang.github.io/posts/dotnet/result-pattern-in-asp-dotnet-core/?ref=footer"><span style=font-weight:700>Next »</span><br>Result Pattern in ASP.NET Core</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#why-cors>Why CORS?</a></li><li><a href=#problems-resolved-by-cors>Problems Resolved by CORS</a></li><li><a href=#what-is-a-preflight-request>What is a Preflight Request?</a></li></ul><ul><li><a href=#step-1-install-the-cors-nuget-package>Step 1: Install the CORS NuGet Package</a></li><li><a href=#step-2-configure-cors-in-startupcs-using-appsettingsjson>Step 2: Configure CORS in Startup.cs using appsettings.json</a></li><li><a href=#enabling-cors-in-net-8-api>Enabling CORS in .NET 8 API</a><ul><li><a href=#step-1-add-the-cors-settings-in-appsettingsjson>Step 1: Add the CORS settings in appsettings.json</a></li><li><a href=#step-2-modify-programcs>Step 2: Modify Program.cs</a></li></ul></li><li><a href=#controlling-access-with-cors-headers>Controlling Access with CORS Headers</a></li></ul><ul><li><a href=#step-1-create-a-new-project>Step 1: Create a New Project</a></li><li><a href=#step-2-modify-programcs-to-use-settings-from-appsettingsjson>Step 2: Modify Program.cs to use settings from appsettings.json</a></li><li><a href=#step-3-add-a-sample-controller>Step 3: Add a Sample Controller</a></li><li><a href=#step-4-run-the-application>Step 4: Run the Application</a></li></ul><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li></ul><ul><li><a href=#when-to-use-cors>When to Use CORS</a></li><li><a href=#when-not-to-use-cors>When Not to Use CORS</a></li></ul><ul><li><a href=#issues>Issues</a></li><li><a href=#considerations>Considerations</a></li><li><a href=#best-practices>Best Practices</a></li></ul></nav></div></div></div></body></html>