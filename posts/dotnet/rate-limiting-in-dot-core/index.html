<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Rate Limiting in ASP.NET Core 8 Web API</title><meta property="og:title" content="Go Sang - Rate Limiting in ASP.NET Core 8 Web API"><meta name=twitter:title content="Go Sang - Rate Limiting in ASP.NET Core 8 Web API"><meta itemprop=name content="Go Sang - Rate Limiting in ASP.NET Core 8 Web API"><meta name=application-name content="Go Sang - Rate Limiting in ASP.NET Core 8 Web API"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/dotnet/rate-limiting-in-dot-core/><link rel=canonical href=https://gosang.github.io/posts/dotnet/rate-limiting-in-dot-core/ itemprop=url><meta name=url content="https://gosang.github.io/posts/dotnet/rate-limiting-in-dot-core/"><meta name=twitter:url content="https://gosang.github.io/posts/dotnet/rate-limiting-in-dot-core/"><meta property="og:url" content="https://gosang.github.io/posts/dotnet/rate-limiting-in-dot-core/"><meta property="og:updated_time" content="18005-18-12T549:29:24+0100"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="18005-18-12T549:29:24+0100"><meta property="article:published_time" content="18005-18-12T549:29:24+0100"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Rate Limiting in ASP.NET Core 8 Web API","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2024-05-18","description":"","wordCount":"774","mainEntityOfPage":"True","dateModified":"2024-05-18","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/>Simplifying Cookie Based and Token Based Authentication</a></li><li class=bullet><a href=https://gosang.github.io/posts/istio/simplifying-oauth-2-in-istio-proxy-sidecar-and-envoy-filter/>Simplifying OAuth 2 in Istio Proxy, Sidecar and Envoy Filter</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/using-quartz-dotnet-with-asp-dotnet-core-and-worker-services/>Using Quartz.NET with ASP.NET Core and Worker Services</a></li><li class=bullet><a href=https://gosang.github.io/posts/security/simplifying-oauth-openid-and-jwt/>Simplifying the OAuth, OpenID, and JWT</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/cancellation-token-in-dotnet-core/>CancellationToken in .NET Core</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2024 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/dotnet/rate-limiting-in-dot-core/>Rate Limiting in ASP.NET Core 8 Web API</a></h1><time datetime=2024-05-18T12:49:29+0100 class=post-date>May 18, 2024</time><ul class=tags><li class="tag-ASP.Net Core"><a href=https://gosang.github.io/tags/asp.net-core>ASP.Net Core</a></li></ul></div><p>Rate limiting is a critical aspect of modern web development, especially in scenarios where resources need to be protected from abuse or excessive usage. In the context of ASP.NET Core 8 Web API development, rate limiting provides a mechanism to control the number of requests made to the API within a specified time period. This blog post will look into the concept of rate limiting, its implementation in ASP.NET Core 8 Web API, its advantages and disadvantages, considerations for implementation, and best practices.</p><h1 id=understanding-rate-limiting>Understanding Rate Limiting</h1><h2 id=what-is-rate-limiting>What is Rate Limiting?</h2><p>Rate limiting is a technique used to control the number of requests an entity (such as a user or IP address) can make to a server within a defined time frame. It helps prevent abuse, protects server resources, and ensures fair usage of the API.</p><h2 id=rationale-and-problems-resolved>Rationale and Problems Resolved</h2><p>Rate limiting addresses several key issues in web development:</p><ul><li><p><strong>Preventing Denial of Service (DoS) Attacks</strong>: By limiting the number of requests, rate limiting mitigates the risk of overwhelming the server with excessive traffic.</p></li><li><p><strong>Protecting Server Resources</strong>: It ensures that server resources are not monopolized by a single user or application, promoting fair usage.</p></li><li><p><strong>Maintaining Quality of Service</strong>: By preventing abuse, rate limiting helps maintain the quality of service for all users, preventing degradation due to excessive load.</p></li></ul><h2 id=context-microservices-or-modular-monolithic>Context: Microservices or Modular Monolithic</h2><p>In microservices architectures, rate limiting can be applied at various levels, such as individual services or API gateways. It ensures that each microservice remains responsive and available, even under heavy load. In modular monolithic architectures, rate limiting can still be valuable, especially when dealing with resource-intensive operations or sensitive endpoints.</p><h1 id=implementing-rate-limiting-in-aspnet-core-8-web-api>Implementing Rate Limiting in ASP.NET Core 8 Web API</h1><h2 id=using-middleware>Using Middleware</h2><p>In ASP.NET Core 8, rate limiting can be implemented using custom middleware. Below is an example of how to implement rate limiting middleware in the context of an e-commerce system:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// RateLimitingMiddleware.cs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RateLimitingMiddleware</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> RequestDelegate _next;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IRateLimitService _rateLimitService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> RateLimitingMiddleware(RequestDelegate next, IRateLimitService rateLimitService)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _next = next;
</span></span><span style=display:flex><span>        _rateLimitService = rateLimitService;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Invoke(HttpContext context)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> clientId = context.Request.Headers[<span style=color:#e6db74>&#34;Client-Id&#34;</span>].FirstOrDefault();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (clientId != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> allowed = <span style=color:#66d9ef>await</span> _rateLimitService.CheckRateLimitAsync(clientId);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (!allowed)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                context.Response.StatusCode = StatusCodes.Status429TooManyRequests;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>await</span> context.Response.WriteAsync(<span style=color:#e6db74>&#34;Rate limit exceeded. Please try again later.&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> _next(context);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=integration-with-mediatr-and-repository-pattern>Integration with MediatR and Repository Pattern</h2><p>When using MediatR and the Repository Pattern, the rate limiting logic can be integrated into the command or query handlers:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Example of a command handler with rate limiting</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderCommandHandler</span> : IRequestHandler&lt;CreateOrderCommand, Unit&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IOrderRepository _orderRepository;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IRateLimitService _rateLimitService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CreateOrderCommandHandler(IOrderRepository orderRepository, IRateLimitService rateLimitService)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _orderRepository = orderRepository;
</span></span><span style=display:flex><span>        _rateLimitService = rateLimitService;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;Unit&gt; Handle(CreateOrderCommand request, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> clientId = request.ClientId;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> allowed = <span style=color:#66d9ef>await</span> _rateLimitService.CheckRateLimitAsync(clientId);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (!allowed)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RateLimitExceededException(<span style=color:#e6db74>&#34;Rate limit exceeded. Please try again later.&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Business logic for creating the order</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> _orderRepository.CreateAsync(request.Order);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Unit.Value;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=advantages-and-disadvantages-of-rate-limiting>Advantages and Disadvantages of Rate Limiting</h1><h2 id=advantages>Advantages</h2><ul><li><p><strong>Security</strong>: Protects against DoS attacks and abusive behavior.</p></li><li><p><strong>Resource Management</strong>: Ensures fair usage of server resources.</p></li><li><p><strong>Improved Stability</strong>: Prevents server overload, leading to improved stability and uptime.</p></li></ul><h2 id=disadvantages>Disadvantages</h2><ul><li><p><strong>Complexity</strong>: Implementing and managing rate limiting adds complexity to the system.</p></li><li><p><strong>Potential False Positives</strong>: Overly aggressive rate limiting can mistakenly block legitimate users.</p></li></ul><h1 id=issues-and-considerations>Issues and Considerations</h1><h2 id=when-to-use-rate-limiting>When to Use Rate Limiting</h2><ul><li><p><strong>High Traffic Scenarios</strong>: Use rate limiting in scenarios where the API is likely to experience high traffic or potential abuse.</p></li><li><p><strong>Sensitive Endpoints</strong>: Apply rate limiting to sensitive endpoints or operations to protect against abuse or DoS attacks.</p></li></ul><h2 id=when-not-to-use-rate-limiting>When Not to Use Rate Limiting</h2><ul><li><p><strong>Internal APIs</strong>: For internal APIs with known and trusted clients, rate limiting may not be necessary.</p></li><li><p><strong>Low-Traffic Scenarios</strong>: In scenarios with low traffic or where abuse is unlikely, rate limiting may be unnecessary overhead.</p></li></ul><h1 id=best-practices>Best Practices</h1><ul><li><p><strong>Granular Rate Limits</strong>: Apply rate limits judiciously, considering the specific needs of each endpoint or operation.</p></li><li><p><strong>Monitoring and Adjustment</strong>: Regularly monitor API usage and adjust rate limits as necessary to maintain balance between security and usability.</p></li><li><p><strong>Communication</strong>: Provide clear feedback to users when rate limits are exceeded, guiding them on how to proceed.</p></li></ul><h1 id=conclusion>Conclusion</h1><p>Rate limiting is a vital tool in the arsenal of modern web developers, particularly in the context of ASP.NET Core 8 Web API development. By implementing rate limiting, developers can protect their APIs from abuse, ensure fair resource usage, and maintain high-quality service for all users. However, it&rsquo;s essential to carefully consider when and how to apply rate limiting, taking into account the specific requirements and constraints of each application.</p><p>For further reading on rate limiting in ASP.NET Core, refer to the official Microsoft documentation on <a href="https://learn.microsoft.com/en-us/aspnet/core/performance/rate-limit?view=aspnetcore-8.0" target=_blank>Rate Limiting Middleware</a>.</p><hr><div class=footer><a class=previous-post href="https://gosang.github.io/posts/testing/load-stress-testing-dotnet-core-web-api-with-apache-jmeter/?ref=footer"><span style=font-weight:700>« Previous</span><br>Load Stress Testing Dotnet Core Web Api With...</a><div class=next-post><a href="https://gosang.github.io/posts/dotnet/software-architecture-testing-in-dotnet-using-archunit/?ref=footer"><span style=font-weight:700>Next »</span><br>Software Architecture Testing in .NET Core Using...</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#what-is-rate-limiting>What is Rate Limiting?</a></li><li><a href=#rationale-and-problems-resolved>Rationale and Problems Resolved</a></li><li><a href=#context-microservices-or-modular-monolithic>Context: Microservices or Modular Monolithic</a></li></ul><ul><li><a href=#using-middleware>Using Middleware</a></li><li><a href=#integration-with-mediatr-and-repository-pattern>Integration with MediatR and Repository Pattern</a></li></ul><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li></ul><ul><li><a href=#when-to-use-rate-limiting>When to Use Rate Limiting</a></li><li><a href=#when-not-to-use-rate-limiting>When Not to Use Rate Limiting</a></li></ul></nav></div></div></div></body></html>