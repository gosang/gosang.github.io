<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Implementing Dapper With ASP.Core 6</title><meta property="og:title" content="Go Sang - Implementing Dapper With ASP.Core 6"><meta name=twitter:title content="Go Sang - Implementing Dapper With ASP.Core 6"><meta itemprop=name content="Go Sang - Implementing Dapper With ASP.Core 6"><meta name=application-name content="Go Sang - Implementing Dapper With ASP.Core 6"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/><link rel=canonical href=https://gosang.github.io/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/ itemprop=url><meta name=url content="https://gosang.github.io/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/"><meta name=twitter:url content="https://gosang.github.io/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/"><meta property="og:url" content="https://gosang.github.io/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/"><meta property="og:updated_time" content="21001-21-04T158:14:24Z"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="21001-21-04T158:14:24Z"><meta property="article:published_time" content="21001-21-04T158:14:24Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Implementing Dapper With ASP.Core 6","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2024-01-21","description":"","wordCount":"1588","mainEntityOfPage":"True","dateModified":"2024-01-21","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-uuid-in-asp-dotnet-core/>Implementing UUID in ASP.NET Core 8</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-guid-in-asp-dotnet-core/>Implementing GUID in ASP.NET Core</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-minimal-api-with-asp-dotnet-core-using-pepr/>Implementing Minimal API With ASP.NET Core Using Request Endpoint Response</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-notification-service-with-aws-sns-in-asp-dotnet-core/>Implementing Notification Service with Amazon SNS in ASP.NET Core 8 API</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/simplifying-object-oriented-programming-in-asp-dotnet-core/>Simplifying Object-Oriented Programming in ASP.NET Core with C#</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2025 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/>Implementing Dapper With ASP.Core 6</a></h1><time datetime=2024-01-21T16:58:14Z class=post-date>January 21, 2024</time><ul class=tags><li class=tag-Dapper><a href=https://gosang.github.io/tags/dapper>Dapper</a></li><li class="tag-ASP.NET Core"><a href=https://gosang.github.io/tags/asp.net-core>ASP.NET Core</a></li></ul><p class=seriesname>Series: <a href=https://gosang.github.io/series/data-store>Data Store</a></p></div><h1 id=introduction>Introduction</h1><p>In the realm of data access in ASP.NET Core 6, developers often face choices between various Object-Relational Mapping (ORM) tools. One such tool that has gained popularity is Dapper. In this blog post, we will look into what Dapper is, its rationale, and how it can be effectively implemented in an ASP.NET Core 6 E-Commerce system.</p><h1 id=understanding-dapper>Understanding Dapper</h1><h2 id=what-is-dapper>What is Dapper?</h2><p>Dapper is a simple, lightweight, and high-performance micro ORM developed by the creators of Stack Overflow. Unlike Entity Framework (EF) Core 6, Dapper focuses on providing a minimalistic set of features to map SQL queries to .NET objects without introducing much abstraction.</p><h2 id=why-dapper>Why Dapper</h2><p>Dapper was created to address the limitations and performance bottlenecks observed in full-fledged ORMs like EF Core 6. Its primary goal is to provide a fast, efficient, and easy-to-use data access layer for applications that require direct control over SQL queries and performance.</p><h2 id=problems-dapper-resolves>Problems Dapper Resolves</h2><ul><li><strong>Performance Optimization</strong>: Dapper excels in scenarios where raw SQL performance is critical, outperforming ORMs like EF Core 6 due to its lightweight nature.</li><li><strong>Control over Queries</strong>: Developers often need to write complex SQL queries, and Dapper allows them to execute these queries directly without significant abstraction.</li><li><strong>Reduced Abstraction Overhead</strong>: Dapper minimizes the abstraction layer between the application and the database, leading to faster execution times and reduced memory footprint.</li></ul><h2 id=dapper-vs-ef-core-6>Dapper vs. EF Core 6</h2><p>While both Dapper and EF Core 6 serve as ORMs, they have different use cases:</p><ol><li>EF Core 6 is feature-rich and abstracts away much of the database interaction, making it easier to use but potentially slower in certain scenarios.</li><li>Dapper is more hands-on, providing direct control over SQL queries and delivering superior performance for read-heavy operations.</li></ol><h1 id=implementing-dapper-in-aspnet-core-6>Implementing Dapper in ASP.NET Core 6</h1><h2 id=e-commerce-system-use-case>E-Commerce System Use Case</h2><p>In an E-Commerce system built on ASP.NET Core 6, efficient data access is crucial for managing product information, customer data, and order processing. Microservices or modular monolithic components are employed to ensure scalability and maintainability.</p><h2 id=web-api-project>Web API Project</h2><p>The Web API Project serves as the entry point for interacting with the E-Commerce system. It exposes a set of RESTful endpoints to handle requests related to products, orders, and customer information. This project is responsible for processing incoming HTTP requests, invoking the appropriate business logic, and returning responses.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Product API</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#a6e22e>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProductController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IUnitOfWork unitOfWork;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ProductController(IUnitOfWork unitOfWork)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.unitOfWork = unitOfWork;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IActionResult&gt; GetAll()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> data = <span style=color:#66d9ef>await</span> unitOfWork.Products.GetAllAsync();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok (data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IActionResult&gt; GetById(<span style=color:#66d9ef>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> data = <span style=color:#66d9ef>await</span> unitOfWork.Products.GetByIdAsync(id);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (data == <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>return</span> Ok();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpPost]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IActionResult&gt; Add(ProductRequest product)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> data = <span style=color:#66d9ef>await</span> unitOfWork.Products.AddAsync(product);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpDelete]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IActionResult&gt; Delete(<span style=color:#66d9ef>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> data = <span style=color:#66d9ef>await</span> unitOfWork.Products.DeleteAsync(id);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpPut]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IActionResult&gt; Update(ProductRequest product)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> data = <span style=color:#66d9ef>await</span> unitOfWork.Products.UpdateAsync(product);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(data);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=repository-project-setup>Repository Project Setup</h2><p>To set up the Repository Project, the following packages need to be installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Install-Package Dapper
</span></span><span style=display:flex><span>Install-Package Microsoft.Extensions.Configuration
</span></span><span style=display:flex><span>Install-Package Microsoft.Extensions.DependencyInjection.Abstractions
</span></span><span style=display:flex><span>Install-Package System.Data.SqlClient
</span></span></code></pre></div><p>These packages provide essential dependencies for Dapper, configuration management, dependency injection, and SQL Server connectivity.</p><h2 id=igenericrepository-interface>IGenericRepository Interface</h2><p>Create an interface IGenericRepository to define generic CRUD operations that the repository and unit of work will use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>IGenericRepository</span>&lt;T&gt; <span style=color:#66d9ef>where</span> T : <span style=color:#66d9ef>class</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    Task&lt;T&gt; GetByIdAsync(<span style=color:#66d9ef>int</span> id);
</span></span><span style=display:flex><span>    Task&lt;IReadOnlyList&lt;T&gt;&gt; GetAllAsync();
</span></span><span style=display:flex><span>    Task&lt;<span style=color:#66d9ef>int</span>&gt; AddAsync(T entity);
</span></span><span style=display:flex><span>    Task&lt;<span style=color:#66d9ef>int</span>&gt; UpdateAsync(T entity);
</span></span><span style=display:flex><span>    Task&lt;<span style=color:#66d9ef>int</span>&gt; DeleteAsync(<span style=color:#66d9ef>int</span> id);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=dapper-repository-project-using-unit-of-work-pattern-and-sql-server-database>Dapper Repository Project using Unit of Work Pattern and SQL Server Database</h2><h3 id=repository-and-unit-of-work>Repository and Unit of Work</h3><p>Implement a generic repository class that utilizes Dapper for data access. The repository, along with the Unit of Work pattern, ensures transactional integrity:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// product entity</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Product</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> Id { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> Name{ <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> Description { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> Barcode { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>decimal</span> Rate { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DateTime AddedOn { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DateTime ModifiedOn { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// IGenericRepository Interface with T as the Product</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>IProductRepository</span> : IGenericRepository&lt;Product&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// IUnitOfWork for IProductRepository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>IUnitOfWork</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    IProductRepository  Products { <span style=color:#66d9ef>get</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ProductRepository</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProductRepository</span> : IProductRepository
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IConfiguration configuration;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ProductRepository(IConfiguration configuration)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.configuration = configuration;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;<span style=color:#66d9ef>int</span>&gt; AddAsync(Product entity)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        entity.AddedOn = DateTime.Now;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> sql = <span style=color:#e6db74>&#34;Insert into Products (Name,Description,Barcode,Rate,AddedOn) VALUES (@Name,@Description,@Barcode,@Rate,@AddedOn)&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> connection = <span style=color:#66d9ef>new</span> SqlConnection(configuration.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>)))
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            connection.Open();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> result = <span style=color:#66d9ef>await</span> connection.ExecuteAsync(sql, entity);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;<span style=color:#66d9ef>int</span>&gt; DeleteAsync(<span style=color:#66d9ef>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> sql = <span style=color:#e6db74>&#34;DELETE FROM Products WHERE Id = @Id&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> connection = <span style=color:#66d9ef>new</span> SqlConnection(configuration.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>)))
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            connection.Open();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> result = <span style=color:#66d9ef>await</span> connection.ExecuteAsync(sql, <span style=color:#66d9ef>new</span> { Id = id });
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IReadOnlyList&lt;Product&gt;&gt; GetAllAsync()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> sql = <span style=color:#e6db74>&#34;SELECT * FROM Products&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> connection = <span style=color:#66d9ef>new</span> SqlConnection(configuration.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>)))
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            connection.Open();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> result = <span style=color:#66d9ef>await</span> connection.QueryAsync&lt;Product&gt;(sql);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result.ToList();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;Product&gt; GetByIdAsync(<span style=color:#66d9ef>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> sql = <span style=color:#e6db74>&#34;SELECT * FROM Products WHERE Id = @Id&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> connection = <span style=color:#66d9ef>new</span> SqlConnection(configuration.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>)))
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            connection.Open();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> result = <span style=color:#66d9ef>await</span> connection.QuerySingleOrDefaultAsync&lt;Product&gt;(sql, <span style=color:#66d9ef>new</span> { Id = id });
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;<span style=color:#66d9ef>int</span>&gt; UpdateAsync(Product entity)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        entity.ModifiedOn = DateTime.Now;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> sql = <span style=color:#e6db74>&#34;UPDATE Products SET Name = @Name, Description = @Description, Barcode = @Barcode, Rate = @Rate, ModifiedOn = @ModifiedOn  WHERE Id = @Id&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> connection = <span style=color:#66d9ef>new</span> SqlConnection(configuration.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>)))
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            connection.Open();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> result = <span style=color:#66d9ef>await</span> connection.ExecuteAsync(sql, entity);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// UnitOfWork inherit from the interface IUnitOfWork</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UnitOfWork</span> : IUnitOfWork
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UnitOfWork(IProductRepository productRepository)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Products = productRepository;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IProductRepository Products { <span style=color:#66d9ef>get</span>; }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=connectionstrings-configuration>ConnectionStrings Configuration</h3><p>Ensure that the ConnectionStrings are configured in <code>appsettings.json</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;ConnectionStrings&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;DefaultConnection&#34;</span>: <span style=color:#e6db74>&#34;your_connection_string_here&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=service-registration>Service Registration</h3><p>Register the repository and unit of work in the ASP.NET Core Dependency Injection container:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other service registrations...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    services.AddTransient&lt;IDbConnection&gt;((sp) =&gt;
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> config = sp.GetRequiredService&lt;IConfiguration&gt;();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> SqlConnection(config.GetConnectionString(<span style=color:#e6db74>&#34;DefaultConnection&#34;</span>));
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   services.AddTransient&lt;IProductRepository, ProductRepository&gt;();
</span></span><span style=display:flex><span>        services.AddTransient&lt;IUnitOfWork, UnitOfWork&gt;();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=automapper-configuration>AutoMapper Configuration</h3><p>Use AutoMapper to simplify the mapping between API requests and domain models:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MappingProfile</span> : Profile
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MappingProfile()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        CreateMap&lt;ProductRequest, Product&gt;();
</span></span><span style=display:flex><span>        CreateMap&lt;Product, ProductResponse&gt;();
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Add other mappings...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=xunit-for-unit-tests-using-dotnet-testcontainers>xUnit for Unit Tests using dotnet testcontainers</h3><p>For unit testing with xUnit and Testcontainers, set up a DatabaseFixture class to handle the Docker container setup:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DatabaseFixture</span> : IDisposable
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IDbConnection Connection { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DatabaseFixture()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Set up a Docker container with SQL Server using Testcontainers</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Initialize Connection...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> Dispose()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Cleanup resources, e.g., stop and remove the Docker container</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ProductRepositoryTests</span> : IClassFixture&lt;DatabaseFixture&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IDbConnection _dbConnection;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ProductRepositoryTests(DatabaseFixture databaseFixture)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _dbConnection = databaseFixture.Connection;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>    [Fact]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> GetProducts_ShouldReturnProducts()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> unitOfWork = <span style=color:#66d9ef>new</span> UnitOfWork(_dbConnection))
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> productRepository = unitOfWork.ProductRepository;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> products = productRepository.GetAll();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            Assert.NotNull(products);
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Add specific assertions based on test requirements</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this setup, the DatabaseFixture class ensures the creation and disposal of a temporary SQL Server Docker container during unit tests.</p><p>By incorporating these elements into the ASP.NET Core 6 E-Commerce system, developers can achieve a well-structured, performant, and testable data access layer using Dapper. The combination of Dapper, the Unit of Work Pattern, AutoMapper, and xUnit with Testcontainers provides a robust foundation for building scalable and reliable applications.</p><p><strong>NOTE</strong>: The code snippets and recommendations provided are for educational purposes and may need to be adapted to specific project requirements.</p><h1 id=advantages-and-disadvantages>Advantages and Disadvantages</h1><h2 id=advantages>Advantages</h2><ul><li><strong>Performance</strong>: Dapper&rsquo;s lightweight nature translates to faster execution times, making it ideal for read-heavy operations.</li><li><strong>Control</strong>: Developers have direct control over SQL queries, enabling optimization for specific use cases.</li></ul><h2 id=disadvantages>Disadvantages</h2><ul><li><strong>Abstraction</strong>: Lack of features compared to EF Core 6 may require developers to write more boilerplate code for complex scenarios.</li><li><strong>Learning Curve</strong>: Developers familiar with full-fledged ORMs might face a learning curve when transitioning to Dapper.</li></ul><h1 id=issues-and-considerations>Issues and Considerations</h1><ul><li><p><strong>Connection Management</strong>: Ensure proper connection management, especially when dealing with distributed systems or microservices. Consider implementing connection pooling to enhance performance.</p></li><li><p><strong>SQL Injection</strong>: Because Dapper allows for direct SQL execution, developers must be cautious about SQL injection vulnerabilities. Always use parameterized queries to mitigate this risk.</p></li></ul><h1 id=when-to-use-dapper>When to Use Dapper</h1><ul><li><strong>Read-Heavy Operations</strong>: Dapper excels in scenarios where efficient retrieval of data is crucial.</li><li><strong>Raw SQL Control</strong>: When direct control over SQL queries is necessary, Dapper provides a straightforward approach.</li></ul><h1 id=when-not-to-use-dapper>When Not to Use Dapper</h1><ul><li><strong>Rapid Prototyping</strong>: For quick application prototyping where speed of development is a priority, a higher-level ORM like EF Core 6 may be more suitable.</li><li><strong>Complex Data Relationships</strong>: In scenarios where complex data relationships and intricate mappings are prevalent, a more feature-rich ORM may be preferable.</li></ul><h1 id=best-practices>Best Practices</h1><ul><li><strong>Parameterized Queries</strong>: Always use parameterized queries to prevent SQL injection.</li><li><strong>Use Repositories and Unit of Work</strong>: Implement the repository and unit of work patterns for better organization and maintainability.</li><li><strong>Performance Testing</strong>: Conduct thorough performance testing to ensure Dapper meets the specific performance requirements of your application.</li></ul><h1 id=conclusion>Conclusion</h1><p>In the realm of ASP.NET Core 6 development, Dapper offers a compelling alternative to traditional ORMs like EF Core 6. By providing a lightweight, high-performance solution, Dapper empowers developers to optimize data access for read-heavy operations. However, it is crucial to consider the specific needs of your application, weighing the advantages and disadvantages before choosing Dapper as your data access tool. As always, thorough testing and adherence to best practices will contribute to the success of your implementation.</p><h1 id=references>References:</h1><ul><li><a href=https://github.com/DapperLib/Dapper target=_blank>Dapper GitHub Repository</a></li><li><a href=https://learn.microsoft.com/en-us/ef/core/ target=_blank>Entity Framework Core Documentation</a></li><li><a href=https://learn.microsoft.com/en-us/aspnet/core/ target=_blank>ASP.NET Core Documentation</a></li><li><a href=https://docs.automapper.org/en/stable/ target=_blank>AutoMapper Documentation</a></li><li><a href>Testcontainers GitHub Repository</a></li><li><a href=https://xunit.net/ target=_blank>xUnit Documentation</a></li></ul><hr><div class=footer><p>This is a post in the <b><a href=https://gosang.github.io/series/data-store>Data Store</a></b> series.<br>Other posts in this series:<ul class=series><li>January 27, 2024 -
<a href=/posts/datastore/optimistic-concurrency-with-etag-in-asp-dotnet-core-8/>Optimistic Concurrency With Etag in ASP.NET Core 8</a></li><li>January 21, 2024 -
Implementing Dapper With ASP.Core 6</li><li>January 20, 2024 -
<a href=/posts/datastore/implementing-entity-framework-core-6-with-asp.net-core-6/>Implementing Entity Framework Core 6 With ASP.NET Core 6</a></li><li>January 13, 2024 -
<a href=/posts/datastore/implementing-ttl-feature-in-mongodb-atlas-with-dotnet-core/>Implementing TTL (Time To Live) Feature in Mongodb Atlas With Dotnet Core</a></li><li>June 27, 2022 -
<a href=/posts/datastore/implementing-mongodb-atlas-with-dotnet-core-using-cqrs/>Implementing Mongodb Atlas With ASP.NET Core Using CQRS</a></li><li>March 27, 2022 -
<a href=/posts/datastore/mongodb-atlas-with-dotnet-core/>Mongodb Atlas With .NET Core</a></li></ul></p></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#what-is-dapper>What is Dapper?</a></li><li><a href=#why-dapper>Why Dapper</a></li><li><a href=#problems-dapper-resolves>Problems Dapper Resolves</a></li><li><a href=#dapper-vs-ef-core-6>Dapper vs. EF Core 6</a></li></ul><ul><li><a href=#e-commerce-system-use-case>E-Commerce System Use Case</a></li><li><a href=#web-api-project>Web API Project</a></li><li><a href=#repository-project-setup>Repository Project Setup</a></li><li><a href=#igenericrepository-interface>IGenericRepository Interface</a></li><li><a href=#dapper-repository-project-using-unit-of-work-pattern-and-sql-server-database>Dapper Repository Project using Unit of Work Pattern and SQL Server Database</a><ul><li><a href=#repository-and-unit-of-work>Repository and Unit of Work</a></li><li><a href=#connectionstrings-configuration>ConnectionStrings Configuration</a></li><li><a href=#service-registration>Service Registration</a></li><li><a href=#automapper-configuration>AutoMapper Configuration</a></li><li><a href=#xunit-for-unit-tests-using-dotnet-testcontainers>xUnit for Unit Tests using dotnet testcontainers</a></li></ul></li></ul><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li></ul></nav></div></div></div></body></html>