<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Implementing Mongodb Atlas With ASP.NET Core Using CQRS</title><meta property="og:title" content="Go Sang - Implementing Mongodb Atlas With ASP.NET Core Using CQRS"><meta name=twitter:title content="Go Sang - Implementing Mongodb Atlas With ASP.NET Core Using CQRS"><meta itemprop=name content="Go Sang - Implementing Mongodb Atlas With ASP.NET Core Using CQRS"><meta name=application-name content="Go Sang - Implementing Mongodb Atlas With ASP.NET Core Using CQRS"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/datastore/implementing-mongodb-atlas-with-dotnet-core-using-cqrs/><link rel=canonical href=https://gosang.github.io/posts/datastore/implementing-mongodb-atlas-with-dotnet-core-using-cqrs/ itemprop=url><meta name=url content="https://gosang.github.io/posts/datastore/implementing-mongodb-atlas-with-dotnet-core-using-cqrs/"><meta name=twitter:url content="https://gosang.github.io/posts/datastore/implementing-mongodb-atlas-with-dotnet-core-using-cqrs/"><meta property="og:url" content="https://gosang.github.io/posts/datastore/implementing-mongodb-atlas-with-dotnet-core-using-cqrs/"><meta property="og:updated_time" content="27006-27-06T61:02:22Z"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="27006-27-06T61:02:22Z"><meta property="article:published_time" content="27006-27-06T61:02:22Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Implementing Mongodb Atlas With ASP.NET Core Using CQRS","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2022-06-27","description":"","wordCount":"2104","mainEntityOfPage":"True","dateModified":"2022-06-27","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/result-pattern-in-asp-dotnet-core/>Result Pattern in Asp Dotnet Core</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/>Simplifying CORS in ASP.NET Core API</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/using-hangfire-with-asp-dotnet-core-and-worker-services/>Using Hangfire with ASP.NET Core and Worker Services</a></li><li class=bullet><a href=https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/>Simplifying Cookie-based and Token-based Authentication</a></li><li class=bullet><a href=https://gosang.github.io/posts/istio/simplifying-oauth-2-in-istio-proxy-sidecar-and-envoy-filter/>Simplifying OAuth 2 in Istio Proxy, Sidecar and Envoy Filter</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2024 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/datastore/implementing-mongodb-atlas-with-dotnet-core-using-cqrs/>Implementing Mongodb Atlas With ASP.NET Core Using CQRS</a></h1><time datetime=2022-06-27T18:01:02Z class=post-date>June 27, 2022</time><ul class=tags><li class="tag-ASP.Net Core"><a href=https://gosang.github.io/tags/asp.net-core>ASP.Net Core</a></li><li class=tag-MongoDB><a href=https://gosang.github.io/tags/mongodb>MongoDB</a></li><li class=tag-CQRS><a href=https://gosang.github.io/tags/cqrs>CQRS</a></li></ul><p class=seriesname>Series: <a href=https://gosang.github.io/series/data-store>Data Store</a></p></div><h1 id=introduction>Introduction</h1><p>In modern application development, choosing the right database solution is crucial for building scalable and efficient systems. MongoDB Atlas, combined with ASP.NET Core and the CQRS (Command Query Responsibility Segregation) pattern, offers a powerful and flexible solution for developing microservices-based applications. This technical blog aims to guide you through the process of implementing MongoDB Atlas with ASP.NET Core using the CQRS pattern, covering key aspects such as MediatR, Docker, and best practices.</p><h1 id=what-is-mongodb-atlas>What is MongoDB Atlas?</h1><p>MongoDB Atlas is a fully managed cloud database service for MongoDB, a NoSQL database. It provides a scalable, secure, and globally distributed environment for storing and retrieving data.</p><h2 id=resolving-common-problems>Resolving Common Problems</h2><ul><li><strong>Scalability</strong>: MongoDB Atlas excels at horizontal scalability, allowing applications to handle growing data and user loads by distributing data across multiple servers.</li><li><strong>Automated Operations</strong>: MongoDB Atlas automates routine database management tasks such as backups, updates, and scaling, reducing operational overhead.</li><li><strong>Global Distribution</strong>: With support for multi-region deployments, MongoDB Atlas ensures low-latency access for users around the world, enhancing the user experience.</li></ul><h2 id=mongodb-atlas-vs-sql-server-database>MongoDB Atlas vs. SQL Server Database</h2><ul><li><strong>Data Model</strong>: MongoDB Atlas uses a flexible and dynamic schema with BSON (Binary JSON), allowing for easy adaptation to changing data requirements. In contrast, SQL Server relies on a rigid schema.</li><li><strong>Scaling</strong>: MongoDB Atlas supports horizontal scaling by distributing data across multiple nodes, while SQL Server typically scales vertically by upgrading hardware.</li><li><strong>Query Language</strong>: MongoDB Atlas uses a rich query language that supports JSON-like documents, while SQL Server uses SQL for querying relational data.</li></ul><h1 id=implementing-mongodb-atlas-with-aspnet-core-and-cqrs>Implementing MongoDB Atlas with ASP.NET Core and CQRS</h1><p>Let&rsquo;s look into a practical example of building an e-commerce system using MongoDB Atlas and ASP.NET Core using CQRS. We&rsquo;ll leverage Docker for containerization, MediatR for implementing the CQRS pattern, FluentValidation for validating input request, AutoMapper for object mapping, and xUnit for unit tests.</p><h2 id=key-technologies-and-libraries>Key Technologies and Libraries</h2><ul><li><strong>ASP.NET Core 6</strong>: The latest version of the cross-platform, high-performance framework for building modern, cloud-based, and internet-connected applications.</li><li><strong>MongoDB.Driver</strong>: The official .NET driver for MongoDB, enabling seamless integration with MongoDB Atlas.</li><li><strong>MediatR</strong>: A library facilitating the implementation of the CQRS pattern, promoting command and query separation.</li><li><strong>FluentValidation</strong>: Used for API request validation and integrated into the CQRS validation pipeline with MediatR.</li><li><strong>AutoMapper</strong>: Streamlines the object-to-object mapping of entities to models, enhancing code readability and maintainability.</li><li><strong>Docker and Docker Compose</strong>: Facilitates containerization and orchestration of microservices, ensuring consistency across development, testing, and production environments.</li><li><strong>xUnit</strong>: The testing framework for unit tests, ensuring the reliability of the application.</li></ul><h2 id=sample-project-structure>Sample Project Structure</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-markdown data-lang=markdown><span style=display:flex><span><span style=color:#66d9ef>-</span> ECommerce.API (ASP.NET Core API)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Controllers
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> MediatR
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> Commands
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>-</span> CreateOrderCommand.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> Queries
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>-</span> GetProductQuery.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> PipelineBehaviors
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>-</span> ValidationBehavior.cs
</span></span><span style=display:flex><span><span style=color:#66d9ef>-</span> ECommerce.Services.Order (Microservice for Order Management)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Handlers
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateOrderCommandHandler.cs
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> MediatR
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> Commands
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>-</span> CreateOrderCommand.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> Queries
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>-</span> GetOrderQuery.cs
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Validators
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateOrderCommandValidator.cs
</span></span><span style=display:flex><span><span style=color:#66d9ef>-</span> ECommerce.Services.Product (Microservice for Product Management)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Handlers
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> GetProductQueryHandler.cs
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> MediatR
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> Commands
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>-</span> CreateProductCommand.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> Queries
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>-</span> GetProductQuery.cs
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Validators
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateProductCommandValidator.cs
</span></span><span style=display:flex><span><span style=color:#66d9ef>-</span> ECommerce.Common (Shared Utilities)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Commands
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateOrderCommand.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateProductCommand.cs
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Queries
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> GetProductQuery.cs
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Validators
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateOrderCommandValidator.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateProductCommandValidator.cs
</span></span><span style=display:flex><span><span style=color:#66d9ef>-</span> ECommerce.Tests (Unit Tests)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Handlers
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateOrderCommandHandlerTests.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> GetProductQueryHandlerTests.cs
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>-</span> Validators
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateOrderCommandValidatorTests.cs
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>-</span> CreateProductCommandValidatorTests.cs
</span></span></code></pre></div><h2 id=setting-up-the-net-core-api-project>Setting up the .NET Core API project</h2><h3 id=step-1-prerequisites>Step 1: Prerequisites</h3><p>Make sure you have the following installed on your machine:</p><ul><li>.NET SDK</li><li>Docker Desktop</li><li>Visual Studio Code (Optional, but recommended for a lightweight IDE)</li><li>MongoDb Atlas</li></ul><h3 id=step-2-project-initialization>Step 2: Project Initialization</h3><ol><li>Create a new .NET Core API project using the following command:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet new webapi -n ECommerce.API
</span></span></code></pre></div><ol start=2><li>Navigate to the project directory:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ECommerce.API
</span></span></code></pre></div><ol start=3><li>Add necessary NuGet packages to the project:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package MediatR
</span></span><span style=display:flex><span>dotnet add package MediatR.Extensions.Microsoft.DependencyInjection
</span></span><span style=display:flex><span>dotnet add package FluentValidation
</span></span><span style=display:flex><span>dotnet add package FluentValidation.DependencyInjectionExtensions
</span></span><span style=display:flex><span>dotnet add package MongoDB.Driver
</span></span></code></pre></div><h3 id=step-3-docker-configuration>Step 3: Docker Configuration</h3><ol><li>Create a Dockerfile in the project directory (<code>ECommerce.API/Dockerfile</code>) with the following content:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/aspnet:6.0 AS base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 80</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 443</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> mcr.microsoft.com/dotnet/sdk:6.0 AS build</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /src</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;ECommerce.API/ECommerce.API.csproj&#34;</span>, <span style=color:#e6db74>&#34;ECommerce.API/&#34;</span><span style=color:#f92672>]</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet restore <span style=color:#e6db74>&#34;ECommerce.API/ECommerce.API.csproj&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> &#34;/src/ECommerce.API&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet build <span style=color:#e6db74>&#34;ECommerce.API.csproj&#34;</span> -c Release -o /app/build<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> build AS publish</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> dotnet publish <span style=color:#e6db74>&#34;ECommerce.API.csproj&#34;</span> -c Release -o /app/publish<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> base AS final</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>publish /app/publish .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;dotnet&#34;</span>, <span style=color:#e6db74>&#34;ECommerce.API.dll&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ol start=2><li>Create a docker-compose.yml file in the project directory with the following content:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.4&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ecommerce.api</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ecommerce-api</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>ECommerce.API/Dockerfile</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5000:80&#34;</span>
</span></span></code></pre></div><h3 id=step-4-debugging-configuration>Step 4: Debugging Configuration</h3><ol><li>Open the ECommerce.API.csproj file in the ECommerce.API project and add the following property group to enable debugging:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;PropertyGroup&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;AspNetCoreHostingModel&gt;</span>InProcess<span style=color:#f92672>&lt;/AspNetCoreHostingModel&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/PropertyGroup&gt;</span>
</span></span></code></pre></div><h3 id=step-5-running-the-application>Step 5: Running the Application</h3><ol><li>Build the Docker image:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose build
</span></span></code></pre></div><ol start=2><li>Run the Docker container:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up
</span></span></code></pre></div><ol start=3><li>Open a web browser and navigate to http://localhost:5000/swagger to access the Swagger UI for the API.</li></ol><p>These are the initial steps for setting up our .net core project. Additional setups or configurations should be done as required.</p><h3 id=mongodb-atlas-setup>MongoDB Atlas Setup</h3><ol><li><p>Create MongoDB Atlas Account</p><ul><li>Visit the <a href=https://www.mongodb.com/cloud/atlas/register target=_blank>MongoDB Atlas website</a>.</li><li>Sign up for a new account or log in if you already have one.</li></ul></li><li><p>Create a Cluster</p><ul><li>Once logged in, click on &ldquo;Build a Cluster.&rdquo;</li><li>Choose your preferred cloud provider, region, and other settings.</li><li>Click &ldquo;Create Cluster&rdquo; to initiate the cluster creation.</li></ul></li><li><p>Configure a Database User</p><ul><li>In the MongoDB Atlas dashboard, navigate to &ldquo;Database Access&rdquo; under the &ldquo;Security&rdquo; section.</li><li>Add a new database user with the necessary privileges.</li></ul></li><li><p>Configure Network Access</p><ul><li>In the MongoDB Atlas dashboard, navigate to &ldquo;Network Access&rdquo; under the &ldquo;Security&rdquo; section.</li><li>Add your IP address to the IP Whitelist to allow connections.</li></ul></li><li><p>Get Connection String</p><ul><li>In the MongoDB Atlas dashboard, click on &ldquo;Connect&rdquo; for your cluster.</li><li>Choose &ldquo;Connect your application&rdquo; and copy the connection string.</li></ul></li></ol><h3 id=configure-mongodb>Configure MongoDB</h3><h4 id=configure-mongodb-connection>Configure MongoDB Connection</h4><p>In our ASP.NET Core application, we need to configure the connection to our MongoDB Atlas cluster. This typically involves setting the connection string, which includes the credentials and cluster information.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Add this to your appsettings.json or appsettings.Development.json</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;MongoDBSettings&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ConnectionString&#34;</span>: <span style=color:#e6db74>&#34;your_mongodb_connection_string&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;DatabaseName&#34;</span>: <span style=color:#e6db74>&#34;your_database_name&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=register-mongodb-services>Register MongoDB Services</h4><p>In the <code>Startup.cs</code> file, configure and register the MongoDB services using the provided connection string and database name.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.Extensions.Configuration;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.Extensions.DependencyInjection;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> MongoDB.Driver;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Startup</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Startup(IConfiguration configuration)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Configuration = configuration;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IConfiguration Configuration { <span style=color:#66d9ef>get</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Other service configurations...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Register MongoDB services</span>
</span></span><span style=display:flex><span>        services.AddSingleton&lt;IMongoClient&gt;(sp =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> settings = Configuration.GetSection(<span style=color:#e6db74>&#34;MongoDBSettings&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> connectionString = settings.GetValue&lt;<span style=color:#66d9ef>string</span>&gt;(<span style=color:#e6db74>&#34;ConnectionString&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> MongoClient(connectionString);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        services.AddScoped&lt;IMongoDatabase&gt;(sp =&gt;
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> client = sp.GetRequiredService&lt;IMongoClient&gt;();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> settings = Configuration.GetSection(<span style=color:#e6db74>&#34;MongoDBSettings&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> databaseName = settings.GetValue&lt;<span style=color:#66d9ef>string</span>&gt;(<span style=color:#e6db74>&#34;DatabaseName&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> client.GetDatabase(databaseName);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Other service configurations...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other methods...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=inject-imongodatabase-in-services>Inject IMongoDatabase in Services</h4><p>Now that we&rsquo;ve registered the MongoDB services, we can inject IMongoDatabase into our services or controllers where needed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SampleService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IMongoDatabase _database;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> YourService(IMongoDatabase database)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _database = database;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> SampleMethod()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Use _database to interact with MongoDB</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> collection = _database.GetCollection&lt;theEntityDocument&gt;(<span style=color:#e6db74>&#34;the_collection_name&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Perform MongoDB operations...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Remember to handle exceptions, implement error handling, and follow best practices for secure database interactions in production application.</p><h2 id=e-commerce-microservices-implementation-with-cqrs-in-net-core>E-commerce Microservices Implementation with CQRS in .Net Core</h2><p>In this project structure, we implement an E-commerce system utilizing microservices architecture, CQRS pattern, FluentValidation for request validation, and MediatR for command and query handling. Below is a detailed explanation of each component, along with corresponding C# code snippets for clarity.</p><h3 id=ecommerceapi-aspnet-core-api>ECommerce.API (ASP.NET Core API)</h3><ul><li><strong>Controllers</strong>: Houses ASP.NET Core controllers responsible for handling incoming HTTP requests.</li><li><strong>MediatR</strong><ul><li><strong>Commands</strong>: Contains command classes for actions like creating orders (<code>CreateOrderCommand</code>).</li><li><strong>Queries</strong>: Holds query classes for retrieving data, such as product details (<code>GetProductQuery</code>).</li><li><strong>PipelineBehaviors</strong>: Includes the <code>ValidationBehavior</code> class responsible for request validation.</li></ul></li></ul><h4 id=code-snippet-ecommerceapi>Code Snippet: ECommerce.API</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.API/Controllers/OrderController.cs</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/orders&#34;)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IMediator _mediator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> OrderController(IMediator mediator)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _mediator = mediator;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpPost]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;IActionResult&gt; CreateOrder([FromBody] CreateOrderCommand command)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> orderId = <span style=color:#66d9ef>await</span> _mediator.Send(command);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(<span style=color:#66d9ef>new</span> { OrderId = orderId });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ecommerceservicesorder-microservice-for-order-management>ECommerce.Services.Order (Microservice for Order Management)</h3><ul><li><strong>Handlers</strong>: Contains classes responsible for handling commands and queries related to order management.</li><li><strong>MediatR</strong><ul><li><strong>Commands</strong>: Includes command classes specific to order management, like <code>CreateOrderCommand</code>.</li><li><strong>Queries</strong>: Holds query classes, such as <code>GetOrderQuery</code>.</li><li><strong>Validators</strong>: Houses validators for commands, like <code>CreateOrderCommandValidator</code>.</li></ul></li></ul><h4 id=code-snippet-ecommerceservicesorder>Code Snippet: ECommerce.Services.Order</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.Services.Order/Handlers/CreateOrderCommandHandler.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderCommandHandler</span> : IRequestHandler&lt;CreateOrderCommand, Guid&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IMongoDatabase _database;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CreateOrderCommandHandler(IMongoDatabase database)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _database = database;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;Guid&gt; Handle(CreateOrderCommand request, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Implement logic to create an order in the MongoDB database</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Guid.NewGuid(); <span style=color:#75715e>// Return the newly created order ID</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ecommerceservicesproduct-microservice-for-product-management>ECommerce.Services.Product (Microservice for Product Management)</h3><ul><li><strong>Handlers</strong>: Contains classes for handling commands and queries related to product management.</li><li><strong>MediatR</strong><ul><li><strong>Commands</strong>: Includes command classes specific to product management, such as <code>CreateProductCommand</code>.</li><li><strong>Queries</strong>: Holds query classes, like <code>GetProductQuery</code>.</li><li><strong>Validators</strong>: Houses validators for commands, for instance, <code>CreateProductCommandValidator</code>.</li></ul></li></ul><h4 id=code-snippet-ecommerceservicesproduct>Code Snippet: ECommerce.Services.Product</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ECommerce.Services.Product/Handlers/GetProductQueryHandler.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GetProductQueryHandler</span> : IRequestHandler&lt;GetProductQuery, ProductDto&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IMongoDatabase _database;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> GetProductQueryHandler(IMongoDatabase database)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _database = database;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;ProductDto&gt; Handle(GetProductQuery request, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Implement logic to retrieve product details from MongoDB</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ProductDto(); <span style=color:#75715e>// Return DTO with product details</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ecommercecommon-shared-utilities>ECommerce.Common (Shared Utilities)</h3><ul><li><strong>Commands</strong>: Contains command classes shared among microservices, like <code>CreateOrderCommand</code> and <code>CreateProductCommand</code>.</li><li><strong>Queries</strong>: Holds query classes shared among microservices, for example, <code>GetProductQuery</code>.</li><li><strong>Validators</strong>: Houses validators shared among microservices, such as <code>CreateOrderCommandValidator</code> and <code>CreateProductCommandValidator</code>.</li></ul><h4 id=code-snippet-ecommercecommon>Code Snippet: ECommerce.Common</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.Common/Commands/CreateOrderCommand.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderCommand</span> : IRequest&lt;Guid&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> ProductId { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> Quantity { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other properties...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>FluentValidation for Commands</p><h3 id=code-snippets-for-validation-and-pipelinebehavior>Code Snippets for Validation and PipelineBehavior</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.Services.Order/Validators/CreateOrderCommandValidator.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderCommandValidator</span> : AbstractValidator&lt;CreateOrderCommand&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CreateOrderCommandValidator()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        RuleFor(command =&gt; command.ProductId).NotEmpty().WithMessage(<span style=color:#e6db74>&#34;Product ID cannot be empty.&#34;</span>);
</span></span><span style=display:flex><span>        RuleFor(command =&gt; command.Quantity).GreaterThan(<span style=color:#ae81ff>0</span>).WithMessage(<span style=color:#e6db74>&#34;Quantity must be greater than zero.&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Additional validation rules...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>FluentValidation for Queries (Optional)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.Common/Queries/GetProductQuery.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GetProductQuery</span> : IRequest&lt;ProductDto&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Guid ProductId { <span style=color:#66d9ef>get</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> GetProductQuery(Guid productId)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        ProductId = productId;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.Services.Product/Validators/GetProductQueryValidator.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>GetProductQueryValidator</span> : AbstractValidator&lt;GetProductQuery&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> GetProductQueryValidator()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        RuleFor(query =&gt; query.ProductId).NotEmpty().WithMessage(<span style=color:#e6db74>&#34;Product ID cannot be empty.&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Additional validation rules...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>MediatR PipelineBehavior for Validation</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.API/MediatR/PipelineBehaviors/ValidationBehavior.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ValidationBehavior</span>&lt;TRequest, TResponse&gt; : IPipelineBehavior&lt;TRequest, TResponse&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IEnumerable&lt;IValidator&lt;TRequest&gt;&gt; _validators;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ValidationBehavior(IEnumerable&lt;IValidator&lt;TRequest&gt;&gt; validators)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _validators = validators;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;TResponse&gt; Handle(TRequest request, CancellationToken cancellationToken, RequestHandlerDelegate&lt;TResponse&gt; next)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> context = <span style=color:#66d9ef>new</span> ValidationContext&lt;TRequest&gt;(request);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> validationFailures = _validators
</span></span><span style=display:flex><span>            .Select(validator =&gt; validator.Validate(context))
</span></span><span style=display:flex><span>            .SelectMany(result =&gt; result.Errors)
</span></span><span style=display:flex><span>            .Where(failure =&gt; failure != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            .ToList();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (validationFailures.Any())
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ValidationException(validationFailures);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>await</span> next();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Registering FluentValidation and PipelineBehavior in Startup.cs</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.API/Startup.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other configurations...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Register FluentValidation for commands and queries</span>
</span></span><span style=display:flex><span>    AssemblyScanner
</span></span><span style=display:flex><span>        .FindValidatorsInAssembly(Assembly.GetExecutingAssembly())
</span></span><span style=display:flex><span>        .ForEach(result =&gt; services.AddScoped(result.InterfaceType, result.ValidatorType));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Register MediatR PipelineBehavior for validation</span>
</span></span><span style=display:flex><span>    services.AddTransient(<span style=color:#66d9ef>typeof</span>(IPipelineBehavior&lt;,&gt;), <span style=color:#66d9ef>typeof</span>(ValidationBehavior&lt;,&gt;));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other services...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ecommercetests-unit-tests>ECommerce.Tests (Unit Tests)</h3><ul><li><strong>Handlers</strong>: Contains unit tests for various handlers to validate their behavior.</li><li><strong>Validators</strong>: Includes unit tests for validators to ensure proper validation.</li></ul><h4 id=code-snippet-ecommercetests>Code Snippet: ECommerce.Tests</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.Tests/Handlers/CreateOrderCommandHandlerTests.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderCommandHandlerTests</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Implement unit tests for the CreateOrderCommandHandler</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// ECommerce.Tests/Validators/CreateOrderCommandValidatorTests.cs</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CreateOrderCommandValidatorTests</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Implement unit tests for the CreateOrderCommandValidator</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=advantages-and-disadvantages-of-mongodb-atlas-with-aspnet-core-and-cqrs>Advantages and Disadvantages of MongoDB Atlas with ASP.NET Core and CQRS</h1><h2 id=advantages>Advantages</h2><ul><li><strong>Scalability</strong>: MongoDB Atlas provides horizontal scalability, allowing applications to handle increased loads effortlessly.</li><li><strong>Flexibility</strong>: The dynamic schema of MongoDB Atlas accommodates evolving data models, promoting flexibility in application development.</li><li><strong>Automation</strong>: Automated operations in MongoDB Atlas reduce administrative overhead, enabling developers to focus on building features.</li></ul><h2 id=disadvantages>Disadvantages</h2><ul><li><strong>Learning Curve</strong>: Developers accustomed to relational databases may face a learning curve when transitioning to MongoDB&rsquo;s NoSQL model.</li><li><strong>Data Integrity Trade-offs</strong>: MongoDB prioritizes flexibility over strict data integrity constraints, requiring careful consideration in application design.</li></ul><h1 id=issues-and-considerations>Issues and Considerations</h1><ul><li><strong>Connection Handling</strong>: Proper connection pooling and handling must be implemented to manage connections effectively and prevent resource exhaustion.</li><li><strong>Security Configuration</strong>: MongoDB Atlas requires robust security configurations, including authentication, encryption, and access control, to ensure data safety.</li><li><strong>Schema Design</strong>: Designing an efficient schema that aligns with application requirements is crucial to avoid performance issues.</li></ul><h1 id=best-practices>Best Practices</h1><ul><li><strong>Indexing</strong>: Utilize appropriate indexes to optimize query performance and enhance database efficiency.</li><li><strong>Connection Pooling</strong>: Implement and configure connection pooling to efficiently manage database connections.</li><li><strong>Data Modeling</strong>: Carefully design the data model to match the application&rsquo;s query patterns and requirements.</li><li><strong>Logging and Monitoring</strong>: Implement comprehensive logging and monitoring to identify and address issues promptly.</li></ul><h1 id=conclusion>Conclusion</h1><p>In this blog, we explored the integration of MongoDB Atlas with ASP.NET Core using the CQRS pattern, showcasing its benefits, considerations, and best practices. MongoDB Atlas empowers developers to build scalable and flexible applications, and when combined with the CQRS pattern, it contributes to a modular and maintainable codebase. By following best practices and considering potential challenges, developers can harness the full potential of MongoDB Atlas in their ASP.NET Core applications.</p><h1 id=references>References</h1><ul><li><a href=https://www.mongodb.com/docs/atlas/ target=_blank>MongoDB Atlas Documentation</a></li><li><a href=https://learn.microsoft.com/en-us/aspnet/core/introduction-to-aspnet-core target=_blank>ASP.NET Core Documentation</a></li><li><a href=https://docs.fluentvalidation.net/en/latest/ target=_blank>FluentValidation Documentation</a></li><li><a href=https://docs.automapper.org/en/stable/ target=_blank>AutoMapper Documentation</a></li><li><a href=https://docs.docker.com/guides/get-started/ target=_blank>Docker Documentation</a></li><li><a href=https://xunit.net/ target=_blank>xUnit Documentation</a></li></ul><hr><div class=footer><p>This is a post in the <b><a href=https://gosang.github.io/series/data-store>Data Store</a></b> series.<br>Other posts in this series:<ul class=series><li>January 27, 2024 -
<a href=/posts/datastore/optimistic-concurrency-with-etag-in-asp-dotnet-core-8/>Optimistic Concurrency With Etag in ASP.NET Core 8</a></li><li>January 21, 2024 -
<a href=/posts/datastore/implementing-dapper-with-asp-dotnet-core-6/>Implementing Dapper With ASP.Core 6</a></li><li>January 20, 2024 -
<a href=/posts/datastore/implementing-entity-framework-core-6-with-asp.net-core-6/>Implementing Entity Framework Core 6 With ASP.NET Core 6</a></li><li>January 13, 2024 -
<a href=/posts/datastore/implementing-ttl-feature-in-mongodb-atlas-with-dotnet-core/>Implementing TTL (Time To Live) Feature in Mongodb Atlas With Dotnet Core</a></li><li>June 27, 2022 -
Implementing Mongodb Atlas With ASP.NET Core Using CQRS</li><li>March 27, 2022 -
<a href=/posts/datastore/mongodb-atlas-with-dotnet-core/>Mongodb Atlas With .NET Core</a></li></ul></p></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#resolving-common-problems>Resolving Common Problems</a></li><li><a href=#mongodb-atlas-vs-sql-server-database>MongoDB Atlas vs. SQL Server Database</a></li></ul><ul><li><a href=#key-technologies-and-libraries>Key Technologies and Libraries</a></li><li><a href=#sample-project-structure>Sample Project Structure</a></li><li><a href=#setting-up-the-net-core-api-project>Setting up the .NET Core API project</a><ul><li><a href=#step-1-prerequisites>Step 1: Prerequisites</a></li><li><a href=#step-2-project-initialization>Step 2: Project Initialization</a></li><li><a href=#step-3-docker-configuration>Step 3: Docker Configuration</a></li><li><a href=#step-4-debugging-configuration>Step 4: Debugging Configuration</a></li><li><a href=#step-5-running-the-application>Step 5: Running the Application</a></li><li><a href=#mongodb-atlas-setup>MongoDB Atlas Setup</a></li><li><a href=#configure-mongodb>Configure MongoDB</a></li></ul></li><li><a href=#e-commerce-microservices-implementation-with-cqrs-in-net-core>E-commerce Microservices Implementation with CQRS in .Net Core</a><ul><li><a href=#ecommerceapi-aspnet-core-api>ECommerce.API (ASP.NET Core API)</a></li><li><a href=#ecommerceservicesorder-microservice-for-order-management>ECommerce.Services.Order (Microservice for Order Management)</a></li><li><a href=#ecommerceservicesproduct-microservice-for-product-management>ECommerce.Services.Product (Microservice for Product Management)</a></li><li><a href=#ecommercecommon-shared-utilities>ECommerce.Common (Shared Utilities)</a></li><li><a href=#code-snippets-for-validation-and-pipelinebehavior>Code Snippets for Validation and PipelineBehavior</a></li><li><a href=#ecommercetests-unit-tests>ECommerce.Tests (Unit Tests)</a></li></ul></li></ul><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li></ul></nav></div></div></div></body></html>