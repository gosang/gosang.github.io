<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Simplifying Cookie-based and Token-based Authentication</title><meta property="og:title" content="Go Sang - Simplifying Cookie-based and Token-based Authentication"><meta name=twitter:title content="Go Sang - Simplifying Cookie-based and Token-based Authentication"><meta itemprop=name content="Go Sang - Simplifying Cookie-based and Token-based Authentication"><meta name=application-name content="Go Sang - Simplifying Cookie-based and Token-based Authentication"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/><link rel=canonical href=https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/ itemprop=url><meta name=url content="https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/"><meta name=twitter:url content="https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/"><meta property="og:url" content="https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/"><meta property="og:updated_time" content="13007-13-12T76:57:24+0100"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="13007-13-12T76:57:24+0100"><meta property="article:published_time" content="13007-13-12T76:57:24+0100"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Simplifying Cookie-based and Token-based Authentication","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2024-07-13","description":"","wordCount":"1057","mainEntityOfPage":"True","dateModified":"2024-07-13","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-minimal-api-with-asp-dotnet-core-using-pepr/>Implementing Minimal API With ASP.NET Core Using Request Endpoint Response</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-notification-service-with-aws-sns-in-asp-dotnet-core/>Implementing Notification Service with Amazon SNS in ASP.NET Core 8 API</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/simplifying-object-oriented-programming-in-asp-dotnet-core/>Simplifying Object-Oriented Programming in ASP.NET Core with C#</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-amazon-sqs-with-asp-dotnet-core/>Implementing Amazon SQS with ASP.NET Core 8 API</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/sending-emails-in-asp-dotnet-core-with-aws-simple-email-service/>Sending Emails in ASP.NET Core With AWS Simple Email Service (SES)</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2024 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/security/simplifying-cookie-based-and-token-based-authentication/>Simplifying Cookie-based and Token-based Authentication</a></h1><time datetime=2024-07-13T12:06:57+0100 class=post-date>July 13, 2024</time><ul class=tags><li class=tag-Security><a href=https://gosang.github.io/tags/security>Security</a></li></ul></div><p>Authentication is a fundamental aspect of web security, ensuring that users are who they claim to be. Two prevalent methods for handling authentication are Cookie-based and Token-based authentication. In this blog, we’ll look into these methods, exploring their concepts, functionalities, advantages, and drawbacks. Additionally, we will provide detailed implementation guides for using Keycloak as an Identity Provider for Token-based authentication in a .NET Core 8 API project and for Cookie-based authentication in a React Next.js project using TypeScript.</p><h1 id=what-is-authentication>What is Authentication?</h1><p>Authentication is the process of verifying the identity of a user or system. It ensures that the person or system accessing resources is indeed who they claim to be. Authentication is typically achieved through credentials such as usernames, passwords, tokens, or certificates.</p><h1 id=cookie-based-authentication>Cookie-based Authentication</h1><h2 id=what-is-cookie-based-authentication>What is Cookie-based Authentication?</h2><p>Cookie-based Authentication uses HTTP cookies to manage user sessions. Upon successful login, the server creates a session and stores it on the server side. A cookie containing the session ID is sent to the client. For subsequent requests, the client sends the cookie to the server to verify the session.</p><h2 id=key-concepts>Key Concepts</h2><p><strong>Sessions</strong>: The server maintains the session state.
<strong>Cookies</strong>: Small pieces of data stored on the client side to maintain session state.
<strong>Server-Side Storage</strong>: Sessions are stored on the server, which can scale poorly with numerous users.</p><h2 id=key-functions>Key Functions</h2><p><strong>Session Creation</strong>: After login, the server creates a session and sends a session ID in a cookie.
<strong>Session Verification</strong>: For each request, the server verifies the session ID from the cookie.</p><h2 id=advantages>Advantages</h2><p><strong>Simplicity</strong>: Easy to implement with built-in browser support.
<strong>Automatic Handling</strong>: Browsers automatically handle cookies.</p><h2 id=disadvantages>Disadvantages</h2><p><strong>Scalability</strong>: Server needs to manage and store sessions.
<strong>Cross-Site Request Forgery (CSRF)</strong>: Vulnerable to CSRF attacks.</p><h2 id=when-to-use>When to Use</h2><p><strong>Small to Medium-Sized Applications</strong>: Ideal for applications with a manageable number of users.</p><h2 id=when-not-to-use>When Not to Use</h2><p><strong>Highly Scalable Applications</strong>: Not suitable for applications with large user bases due to server-side session management overhead.</p><h1 id=token-based-authentication>Token-based Authentication</h1><h2 id=what-is-token-based-authentication>What is Token-based Authentication?</h2><p>Token-based Authentication uses tokens, such as JSON Web Tokens (JWT), to manage user sessions. Upon successful login, the server issues a token to the client. The client includes this token in the header of subsequent requests.</p><h2 id=key-concepts-1>Key Concepts</h2><ul><li><strong>Stateless</strong>: Tokens are self-contained and do not require server-side storage.</li><li><strong>Tokens</strong>: Encoded data that can be verified and trusted.</li><li><strong>Decentralized Storage</strong>: Tokens are stored on the client side.</li></ul><h2 id=key-functions-1>Key Functions</h2><p>Token Issuance: After login, the server issues a token to the client.
Token Verification: For each request, the server verifies the token.</p><h2 id=advantages-1>Advantages</h2><ul><li><strong>Scalability</strong>: Tokens do not require server-side session storage.</li><li><strong>Cross-Domain Compatibility</strong>: Tokens can be used across different domains.</li></ul><h2 id=disadvantages-1>Disadvantages</h2><ul><li><strong>Complexity</strong>: More complex to implement than Cookie-based authentication.</li><li><strong>Token Revocation</strong>: Difficult to revoke tokens.</li></ul><h2 id=when-to-use-1>When to Use</h2><p><strong>Microservices Architecture</strong>- : Ideal for applications with distributed components.</p><ul><li><strong>APIs</strong>: Suitable for API authentication due to stateless nature.</li></ul><h2 id=when-not-to-use-1>When Not to Use</h2><ul><li><strong>Simpler Applications</strong>: Overkill for small applications with a limited user base.</li></ul><h1 id=implementing-token-based-authentication-with-keycloak-in-net-core-8-api>Implementing Token-based Authentication with Keycloak in .NET Core 8 API</h1><h2 id=prerequisites>Prerequisites</h2><ul><li>.NET Core 8 SDK</li><li>Keycloak server setup</li></ul><h2 id=step-by-step-guide>Step-by-Step Guide</h2><h3 id=1-install-keycloak-nuget-packages>1. Install Keycloak NuGet Packages:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package Keycloak.Net
</span></span><span style=display:flex><span>dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer
</span></span></code></pre></div><h3 id=2-configure-keycloak-in-appsettingsjson>2. Configure Keycloak in appsettings.json:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Keycloak&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Realm&#34;</span>: <span style=color:#e6db74>&#34;your-realm&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ClientId&#34;</span>: <span style=color:#e6db74>&#34;your-client-id&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ClientSecret&#34;</span>: <span style=color:#e6db74>&#34;your-client-secret&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Authority&#34;</span>: <span style=color:#e6db74>&#34;http://localhost:8080/auth/realms/your-realm&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-configure-authentication-in-programcs>3. Configure Authentication in Program.cs:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> keycloakConfig = builder.Configuration.GetSection(<span style=color:#e6db74>&#34;Keycloak&#34;</span>);
</span></span><span style=display:flex><span>builder.Services.AddAuthentication(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
</span></span><span style=display:flex><span>    options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
</span></span><span style=display:flex><span>}).AddJwtBearer(options =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    options.Authority = keycloakConfig[<span style=color:#e6db74>&#34;Authority&#34;</span>];
</span></span><span style=display:flex><span>    options.Audience = keycloakConfig[<span style=color:#e6db74>&#34;ClientId&#34;</span>];
</span></span><span style=display:flex><span>    options.RequireHttpsMetadata = <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>app.UseAuthentication();
</span></span><span style=display:flex><span>app.UseAuthorization();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.MapControllers();
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><h3 id=4-protect-api-endpoints>4. Protect API Endpoints:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[Authorize]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[ApiController]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SecureController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult GetSecureData()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(<span style=color:#e6db74>&#34;This is a secure endpoint&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=implementing-cookie-based-authentication-in-react-nextjs-with-typescript>Implementing Cookie-based Authentication in React Next.js with TypeScript</h1><h2 id=prerequisites-1>Prerequisites</h2><ul><li>Node.js and npm</li><li>Next.js project setup</li></ul><h2 id=step-by-step-guide-1>Step-by-Step Guide</h2><h3 id=1-install-required-packages>1. Install Required Packages:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install next-cookies axios js-cookie
</span></span></code></pre></div><h3 id=2-setup-authentication-context>2. Setup Authentication Context:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// context/AuthContext.tsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createContext</span>, <span style=color:#a6e22e>useState</span>, <span style=color:#a6e22e>useEffect</span>, <span style=color:#a6e22e>ReactNode</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>Cookies</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;js-cookie&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>axios</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;axios&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>AuthContextProps</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>user</span>: <span style=color:#66d9ef>string</span> <span style=color:#f92672>|</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>login</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>username</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>password</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>Promise</span>&lt;<span style=color:#f92672>void</span>&gt;;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>logout</span><span style=color:#f92672>:</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>void</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>AuthContext</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createContext</span>&lt;<span style=color:#f92672>AuthContextProps</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>undefined</span>&gt;(<span style=color:#66d9ef>undefined</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>AuthProvider</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>children</span> }<span style=color:#f92672>:</span> { <span style=color:#a6e22e>children</span>: <span style=color:#66d9ef>ReactNode</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>setUser</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>&lt;<span style=color:#f92672>string</span> <span style=color:#960050;background-color:#1e0010>|</span> <span style=color:#a6e22e>null</span>&gt;(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>useEffect</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>savedUser</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Cookies</span>.<span style=color:#66d9ef>get</span>(<span style=color:#e6db74>&#34;user&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>savedUser</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>setUser</span>(<span style=color:#a6e22e>savedUser</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }, []);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>login</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>username</span>: <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>password</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>axios</span>.<span style=color:#a6e22e>post</span>(<span style=color:#e6db74>&#34;/api/login&#34;</span>, { <span style=color:#a6e22e>username</span>, <span style=color:#a6e22e>password</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Cookies</span>.<span style=color:#66d9ef>set</span>(<span style=color:#e6db74>&#34;user&#34;</span>, <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>user</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setUser</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>user</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>logout</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Cookies</span>.<span style=color:#a6e22e>remove</span>(<span style=color:#e6db74>&#34;user&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setUser</span>(<span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>AuthContext.Provider</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>user</span>, <span style=color:#a6e22e>login</span>, <span style=color:#a6e22e>logout</span> }}&gt;
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>children</span>}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>AuthContext.Provider</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id=3-create-login-api-route>3. Create Login API Route:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// pages/api/login.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>NextApiRequest</span>, <span style=color:#a6e22e>NextApiResponse</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>req</span>: <span style=color:#66d9ef>NextApiRequest</span>, <span style=color:#a6e22e>res</span>: <span style=color:#66d9ef>NextApiResponse</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>username</span>, <span style=color:#a6e22e>password</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Mock authentication
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>username</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;user&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>password</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;pass&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>200</span>).<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>user</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;user&#34;</span> });
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>401</span>).<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Invalid credentials&#34;</span> });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=4-protect-client-side-routes>4. Protect Client-Side Routes:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// pages/protected.tsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useContext</span>, <span style=color:#a6e22e>useEffect</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useRouter</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next/router&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>AuthContext</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../context/AuthContext&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ProtectedPage</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>authContext</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useContext</span>(<span style=color:#a6e22e>AuthContext</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>router</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>useRouter</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>useEffect</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>authContext</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>user</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>push</span>(<span style=color:#e6db74>&#34;/login&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }, [<span style=color:#a6e22e>authContext</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>user</span>]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>authContext</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>user</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>Loading</span>...&lt;/<span style=color:#f92672>div</span>&gt;;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>div</span>&gt;<span style=color:#a6e22e>This</span> <span style=color:#66d9ef>is</span> <span style=color:#a6e22e>a</span> <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>page</span>&lt;/<span style=color:#f92672>div</span>&gt;;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>ProtectedPage</span>;
</span></span></code></pre></div><h1 id=issues-considerations-and-best-practices>Issues, Considerations, and Best Practices</h1><h2 id=cookie-based-authentication-1>Cookie-based Authentication</h2><h3 id=issues>Issues</h3><ul><li><strong>CSRF</strong>: Cookies are automatically sent with requests, making CSRF attacks possible.</li><li><strong>Storage Limitation</strong>: Limited data storage capacity in cookies.</li></ul><h3 id=considerations>Considerations</h3><ul><li><strong>Use HttpOnly and Secure Flags</strong>: Mitigates risks of XSS attacks.</li><li><strong>CSRF Tokens</strong>: Implement CSRF tokens to protect against CSRF attacks.</li></ul><h3 id=best-practices>Best Practices</h3><ul><li><strong>Short Lifespan</strong>: Keep session duration short.</li><li><strong>Regular Rotation</strong>: Rotate session IDs regularly.</li></ul><h2 id=token-based-authentication-1>Token-based Authentication</h2><h3 id=issues-1>Issues</h3><ul><li><strong>Token Revocation</strong>: Difficult to revoke tokens immediately.</li><li><strong>Security</strong>: Tokens can be intercepted if not properly secured.</li></ul><h3 id=considerations-1>Considerations</h3><ul><li><strong>Token Expiry</strong>: Implement short-lived tokens with refresh tokens.</li><li><strong>Secure Transmission</strong>: Use HTTPS to secure token transmission.</li></ul><h3 id=best-practices-1>Best Practices</h3><ul><li><strong>Audience and Issuer Validation</strong>: Ensure tokens are valid for your audience and issuer.</li><li><strong>Refresh Tokens</strong>: Use refresh tokens to maintain long-term sessions securely.</li></ul><h1 id=conclusion>Conclusion</h1><p>Understanding the differences between Cookie-based and Token-based authentication is crucial for building secure web applications. Each method has its unique advantages and disadvantages, making them suitable for different scenarios. By following the best practices and considerations outlined in this blog, you can implement robust authentication mechanisms tailored to your application&rsquo;s needs.</p><h1 id=references>References</h1><ul><li><a href=https://oauth.net/2/ target=_blank>OAuth 2.0 Framework</a></li><li><a href=https://oauth.net/2/jwt/ target=_blank>JWT RFC</a></li></ul><hr><div class=footer><a class=previous-post href="https://gosang.github.io/posts/istio/simplifying-oauth-2-in-istio-proxy-sidecar-and-envoy-filter/?ref=footer"><span style=font-weight:700>« Previous</span><br>Simplifying OAuth 2 in Istio Proxy, Sidecar and...</a><div class=next-post><a href="https://gosang.github.io/posts/dotnet/using-hangfire-with-asp-dotnet-core-and-worker-services/?ref=footer"><span style=font-weight:700>Next »</span><br>Using Hangfire with ASP.NET Core and Worker...</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#what-is-cookie-based-authentication>What is Cookie-based Authentication?</a></li><li><a href=#key-concepts>Key Concepts</a></li><li><a href=#key-functions>Key Functions</a></li><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li><li><a href=#when-to-use>When to Use</a></li><li><a href=#when-not-to-use>When Not to Use</a></li></ul><ul><li><a href=#what-is-token-based-authentication>What is Token-based Authentication?</a></li><li><a href=#key-concepts-1>Key Concepts</a></li><li><a href=#key-functions-1>Key Functions</a></li><li><a href=#advantages-1>Advantages</a></li><li><a href=#disadvantages-1>Disadvantages</a></li><li><a href=#when-to-use-1>When to Use</a></li><li><a href=#when-not-to-use-1>When Not to Use</a></li></ul><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#step-by-step-guide>Step-by-Step Guide</a><ul><li><a href=#1-install-keycloak-nuget-packages>1. Install Keycloak NuGet Packages:</a></li><li><a href=#2-configure-keycloak-in-appsettingsjson>2. Configure Keycloak in appsettings.json:</a></li><li><a href=#3-configure-authentication-in-programcs>3. Configure Authentication in Program.cs:</a></li><li><a href=#4-protect-api-endpoints>4. Protect API Endpoints:</a></li></ul></li></ul><ul><li><a href=#prerequisites-1>Prerequisites</a></li><li><a href=#step-by-step-guide-1>Step-by-Step Guide</a><ul><li><a href=#1-install-required-packages>1. Install Required Packages:</a></li><li><a href=#2-setup-authentication-context>2. Setup Authentication Context:</a></li><li><a href=#3-create-login-api-route>3. Create Login API Route:</a></li><li><a href=#4-protect-client-side-routes>4. Protect Client-Side Routes:</a></li></ul></li></ul><ul><li><a href=#cookie-based-authentication-1>Cookie-based Authentication</a><ul><li><a href=#issues>Issues</a></li><li><a href=#considerations>Considerations</a></li><li><a href=#best-practices>Best Practices</a></li></ul></li><li><a href=#token-based-authentication-1>Token-based Authentication</a><ul><li><a href=#issues-1>Issues</a></li><li><a href=#considerations-1>Considerations</a></li><li><a href=#best-practices-1>Best Practices</a></li></ul></li></ul></nav></div></div></div></body></html>