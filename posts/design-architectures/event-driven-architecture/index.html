<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Event-Driven Architecture</title><meta property="og:title" content="Go Sang - Event-Driven Architecture"><meta name=twitter:title content="Go Sang - Event-Driven Architecture"><meta itemprop=name content="Go Sang - Event-Driven Architecture"><meta name=application-name content="Go Sang - Event-Driven Architecture"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/design-architectures/event-driven-architecture/><link rel=canonical href=https://gosang.github.io/posts/design-architectures/event-driven-architecture/ itemprop=url><meta name=url content="https://gosang.github.io/posts/design-architectures/event-driven-architecture/"><meta name=twitter:url content="https://gosang.github.io/posts/design-architectures/event-driven-architecture/"><meta property="og:url" content="https://gosang.github.io/posts/design-architectures/event-driven-architecture/"><meta property="og:updated_time" content="25004-25-01T458:28:21Z"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="25004-25-01T458:28:21Z"><meta property="article:published_time" content="25004-25-01T458:28:21Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Event-Driven Architecture","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2021-04-25","description":"","wordCount":"1220","mainEntityOfPage":"True","dateModified":"2021-04-25","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/devops/kubernetes/using-multiple-namespaces-in-kubernetes/>Using Multiple Namespaces in Kubernetes</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/simplifying-the-nextjs-server-actions/>Simplifying the Next.js Server Actions</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/result-pattern-in-asp-dotnet-core/>Result Pattern in ASP.NET Core</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/simplifying-cors-in-asp-dotnet-core-api/>Simplifying CORS in ASP.NET Core API</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/using-hangfire-with-asp-dotnet-core-and-worker-services/>Using Hangfire with ASP.NET Core and Worker Services</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2024 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/design-architectures/event-driven-architecture/>Event-Driven Architecture</a></h1><time datetime=2021-04-25T13:58:28Z class=post-date>April 25, 2021</time><p class=seriesname>Series: <a href=https://gosang.github.io/series/design-architectures>Design Architectures</a></p></div><p>Event-Driven Architecture (EDA) has become a pivotal design paradigm in building scalable, loosely-coupled systems. In this blog, we&rsquo;ll look into the core concepts of Event-Driven Architecture, its implementation in the context of an e-commerce system using C# .NET Core, and explore its advantages, disadvantages, issues, and best practices.</p><h1 id=what-is-event-driven-architecture>What is Event-Driven Architecture?</h1><p>At its core, Event-Driven Architecture is a design pattern that orchestrates the flow of information between different components or services through events. An event represents a significant change in state or occurrence within a system. Unlike traditional request-response models, EDA promotes asynchronous communication, allowing components to react to events without direct coupling.</p><h1 id=why-event-driven-architecture>Why Event-Driven Architecture?</h1><p>The rationale behind adopting Event-Driven Architecture lies in achieving a more modular, scalable, and maintainable system. By decoupling components through events, changes in one part of the system don&rsquo;t propagate directly to others. This promotes flexibility and responsiveness, making it easier to adapt to evolving requirements.</p><h1 id=problems-resolved-by-event-driven-architecture>Problems Resolved by Event-Driven Architecture</h1><ul><li><p><strong>Loose Coupling</strong>: Components are decoupled, reducing the impact of changes and enabling independent evolution.</p></li><li><p><strong>Scalability</strong>: Asynchronous communication facilitates better scalability, as components can handle varying workloads independently.</p></li><li><p><strong>Flexibility</strong>: Components can evolve independently, fostering a more adaptable system.</p></li></ul><h1 id=implementing-event-driven-architecture-in-e-commerce-using-c-net-core>Implementing Event-Driven Architecture in E-Commerce using C# .NET Core</h1><p>In this example, we&rsquo;ll illustrate the implementation of EDA in an e-commerce system using C# .NET Core. Our services and APIs will be built using the MediatR library to implement the CQRS pattern, AutoMapper for object mapping, EF Core InMemory database for simplicity, and xUnit for unit tests.</p><h3 id=setup-a-net-core-api-project>Setup a .NET Core API Project</h3><ol><li>Create a new .NET Core API project:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet new webapi -n OrderApi
</span></span></code></pre></div><ol start=2><li>Install necessary packages:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package MediatR
</span></span><span style=display:flex><span>dotnet add package MediatR.Extensions.Microsoft.DependencyInjection
</span></span></code></pre></div><ol start=3><li>Configure MediatR in <code>Startup.cs</code>:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> ConfigureServices(IServiceCollection services)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    services.AddMediatR(<span style=color:#66d9ef>typeof</span>(Startup));
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other configurations...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=add-a-repository-for-the-order-using-ef-core-inmemory>Add a Repository for the Order using EF Core InMemory</h3><p>Now, let&rsquo;s set up a repository using EF Core InMemory to manage orders.</p><h4 id=install-ef-core-inmemory-package>Install EF Core InMemory package:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package Microsoft.EntityFrameworkCore.InMemory
</span></span></code></pre></div><h4 id=define-the-order-model-and-the-orderrepository>Define the Order model and the OrderRepository:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Order</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> OrderId { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Other order details...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderRepository</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> List&lt;Order&gt; orders = <span style=color:#66d9ef>new</span> List&lt;Order&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> AddOrder(Order order)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        orders.Add(order);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Implement other repository methods as needed...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=adding-sample-unit-tests-using-xunit>Adding Sample Unit Tests using xUnit</h3><p>Let&rsquo;s create some basic unit tests to ensure the functionality of our order handling system.</p><h4 id=install-xunit-packages>Install xUnit packages:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package xunit
</span></span><span style=display:flex><span>dotnet add package xunit.runner.visualstudio
</span></span><span style=display:flex><span>dotnet add package Microsoft.NET.Test.Sdk
</span></span></code></pre></div><h4 id=create-a-test-class-for-the-orderrepository>Create a test class for the <code>OrderRepository</code>:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderRepositoryTests</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [Fact]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> AddOrder_ShouldAddOrderToList()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Arrange</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> orderRepository = <span style=color:#66d9ef>new</span> OrderRepository();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> order = <span style=color:#66d9ef>new</span> Order { OrderId = <span style=color:#ae81ff>1</span>, <span style=color:#75715e>/* other order details */</span> };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Act</span>
</span></span><span style=display:flex><span>        orderRepository.AddOrder(order);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Assert</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> orders = orderRepository.GetOrders();
</span></span><span style=display:flex><span>        Assert.Contains(order, orders);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add more tests as needed...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=mediatr-for-cqrs-pattern>MediatR for CQRS Pattern</h3><p>MediatR simplifies the implementation of the Command Query Responsibility Segregation (CQRS) pattern. With CQRS, commands and queries are separated, enhancing maintainability and scalability. In our example, we use MediatR to define commands, their corresponding handlers, and to publish events upon successful command execution.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Define command and handler</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PlaceOrderCommand</span> : IRequest&lt;<span style=color:#66d9ef>int</span>&gt; { <span style=color:#75715e>/* Command details */</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PlaceOrderCommandHandler</span> : IRequestHandler&lt;PlaceOrderCommand, <span style=color:#66d9ef>int</span>&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task&lt;<span style=color:#66d9ef>int</span>&gt; Handle(PlaceOrderCommand request, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Handle command logic (e.g., order placement)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Emit an event after successful order placement</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> mediator.Publish(<span style=color:#66d9ef>new</span> OrderPlacedEvent());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> orderId;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=event-definition>Event Definition</h3><p>Events represent occurrences in the system. In our example, the <code>OrderPlacedEvent</code> is a notification indicating that an order has been successfully placed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Define an event</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderPlacedEvent</span> : INotification { <span style=color:#75715e>/* Event details */</span> }
</span></span><span style=display:flex><span>Handling Events
</span></span><span style=display:flex><span>csharp
</span></span><span style=display:flex><span>Copy code
</span></span><span style=display:flex><span><span style=color:#75715e>// Event handler</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderPlacedEventHandler</span> : INotificationHandler&lt;OrderPlacedEvent&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Handle(OrderPlacedEvent notification, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Handle event logic (e.g., send email notification)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=handling-events>Handling Events</h3><p>Event handlers respond to specific events. Here, the <code>OrderPlacedEventHandler</code> listens for the <code>OrderPlacedEvent</code> and performs actions such as sending email notifications.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// Event handler</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderPlacedEventHandler</span> : INotificationHandler&lt;OrderPlacedEvent&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Handle(OrderPlacedEvent notification, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Handle event logic (e.g., send email notification)</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=docker-compose-yaml>Docker Compose YAML</h3><p>The Docker Compose YAML file defines services for the e-commerce API and the event handler. It allows you to run both components as Docker containers, simulating a distributed system.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.8&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ecommerce-api</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ecommerce-api-image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5000:80&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ecommerce-event-handler</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>event-handler-image</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ecommerce-api</span>
</span></span></code></pre></div><h2 id=setup-in-local-development-and-debugging-using-docker-desktop>Setup in Local Development and Debugging using Docker Desktop</h2><ul><li><strong>Build Docker Images</strong>: Build the Docker images for the e-commerce API and event handler using the provided Dockerfiles.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t ecommerce-api-image .
</span></span><span style=display:flex><span>docker build -t event-handler-image .
</span></span></code></pre></div><ul><li><strong>Run Docker Compose</strong>: Use Docker Compose to start the services.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up
</span></span></code></pre></div><ul><li><p><strong>Debugging with Docker Desktop</strong>: Debugging can be achieved by attaching a debugger to the running containers. In Visual Studio, configure your project for Docker debugging, set breakpoints, and run in debug mode.</p></li><li><p>Attach the debugger to both running containers (<code>ecommerce-api</code> and <code>ecommerce-event-handler</code>).</p></li><li><p>Monitor logs and debug as needed.</p></li></ul><p>This setup allows you to emulate a microservices environment locally, testing the Event-Driven Architecture&rsquo;s functionality and ensuring seamless communication between services.</p><h1 id=advantages-and-disadvantages-of-event-driven-architecture>Advantages and Disadvantages of Event-Driven Architecture</h1><h2 id=advantages>Advantages</h2><ul><li><strong>Scalability</strong>: EDA allows for independent scaling of components, improving overall system scalability.</li><li><strong>Flexibility</strong>: Loose coupling enables components to evolve independently, enhancing system flexibility.</li><li><strong>Asynchronous Communication</strong>: Events facilitate asynchronous communication, making the system more responsive.</li></ul><h2 id=disadvantages>Disadvantages</h2><ul><li><strong>Complexity</strong>: Implementing and maintaining event-driven systems can be complex.</li><li><strong>Consistency Challenges</strong>: Ensuring consistency in distributed systems may require additional mechanisms.</li></ul><h1 id=issues-and-considerations-for-event-driven-architecture>Issues and Considerations for Event-Driven Architecture</h1><ul><li><strong>Order of Events</strong>: Ensuring the correct order of events can be challenging in distributed systems. Implement event versioning and handling mechanisms.</li><li><strong>Event Loss</strong>: Events may be lost during transmission. Use reliable message brokers and implement proper error handling and retry mechanisms.</li><li><strong>Consistency Across Services</strong>: Maintaining consistency when multiple services react to the same event requires careful design. Consider eventual consistency patterns.</li></ul><h1 id=when-to-use-event-driven-architecture-and-use-casesscenarios>When to Use Event-Driven Architecture and Use Cases/Scenarios</h1><p>Event-Driven Architecture is beneficial when:</p><ul><li><strong>Loose Coupling is Essential</strong>: Components need to evolve independently.</li><li><strong>Asynchronous Communication is Preferred</strong>: Asynchronous communication is beneficial for responsiveness.</li><li><strong>Scalability is a Concern</strong>: Scalability of individual components is a priority.</li></ul><p>Use cases include:</p><ul><li><strong>E-Commerce Systems</strong>: Handling order placements, inventory updates, and shipping notifications asynchronously.</li><li><strong>IoT Applications</strong>: Reacting to sensor data or device events in real-time.</li><li><strong>Microservices Architecture</strong>: Coordinating actions between microservices.</li></ul><h1 id=when-not-to-use-event-driven-architecture>When Not to Use Event-Driven Architecture</h1><ul><li><strong>Simple, Monolithic Systems</strong>: For small, straightforward applications, the overhead of implementing EDA might outweigh the benefits.</li><li><strong>Synchronous Communication Requirements</strong>: If the system heavily relies on synchronous communication, EDA may introduce unnecessary complexity.</li></ul><h1 id=best-practices-for-event-driven-architecture>Best Practices for Event-Driven Architecture</h1><ul><li><strong>Event Schema Versioning</strong>: Include versioning in event schemas to handle evolving systems.</li><li><strong>Idempotent Event Handling</strong>: Ensure event handlers can safely handle the same event multiple times without unintended side effects.</li><li><strong>Use Reliable Message Brokers</strong>: Employ reliable message brokers like RabbitMQ or Kafka for event transport.</li><li><strong>Event Logging and Monitoring</strong>: Implement comprehensive logging and monitoring for events to facilitate debugging and analysis.</li></ul><h1 id=conclusion>Conclusion</h1><p>Event-Driven Architecture provides a robust solution for building scalable, flexible, and responsive systems. Leveraging C# .NET Core and associated libraries, we demonstrated its implementation in the context of an e-commerce system. Understanding its advantages, disadvantages, issues, and best practices is crucial for successful adoption.</p><h1 id=references>References</h1><p><a href=https://learn.microsoft.com/en-us/azure/architecture/guide/architecture-styles/event-driven target=_blank>Event-Driven Architecture</a></p><hr><div class=footer><p>This is a post in the <b><a href=https://gosang.github.io/series/design-architectures>Design Architectures</a></b> series.<br>Other posts in this series:<ul class=series><li>May 16, 2023 -
<a href=/posts/design-architectures/domain-driven-design/>Domain Driven Design (DDD)</a></li><li>August 7, 2021 -
<a href=/posts/design-architectures/vertical-slice-architecture/>Vertical Slice Architecture</a></li><li>April 25, 2021 -
Event-Driven Architecture</li><li>June 30, 2020 -
<a href=/posts/design-architectures/microservices/>Microservices Design Architecture</a></li><li>May 3, 2020 -
<a href=/posts/design-architectures/modular-monolith-architecture/>Modular Monolith Architecture</a></li><li>March 2, 2020 -
<a href=/posts/design-architectures/clean-architecture/>Clean Architecture</a></li></ul></p></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><ul><li><a href=#setup-a-net-core-api-project>Setup a .NET Core API Project</a></li><li><a href=#add-a-repository-for-the-order-using-ef-core-inmemory>Add a Repository for the Order using EF Core InMemory</a></li><li><a href=#adding-sample-unit-tests-using-xunit>Adding Sample Unit Tests using xUnit</a></li><li><a href=#mediatr-for-cqrs-pattern>MediatR for CQRS Pattern</a></li><li><a href=#event-definition>Event Definition</a></li><li><a href=#handling-events>Handling Events</a></li><li><a href=#docker-compose-yaml>Docker Compose YAML</a></li></ul></li><li><a href=#setup-in-local-development-and-debugging-using-docker-desktop>Setup in Local Development and Debugging using Docker Desktop</a></li></ul><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li></ul></nav></div></div></div></body></html>