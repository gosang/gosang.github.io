<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Publish–subscribe Pattern</title><meta property="og:title" content="Go Sang - Publish–subscribe Pattern"><meta name=twitter:title content="Go Sang - Publish–subscribe Pattern"><meta itemprop=name content="Go Sang - Publish–subscribe Pattern"><meta name=application-name content="Go Sang - Publish–subscribe Pattern"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/design-patterns/microservices/publishsubscribe-pattern/><link rel=canonical href=https://gosang.github.io/posts/design-patterns/microservices/publishsubscribe-pattern/ itemprop=url><meta name=url content="https://gosang.github.io/posts/design-patterns/microservices/publishsubscribe-pattern/"><meta name=twitter:url content="https://gosang.github.io/posts/design-patterns/microservices/publishsubscribe-pattern/"><meta property="og:url" content="https://gosang.github.io/posts/design-patterns/microservices/publishsubscribe-pattern/"><meta property="og:updated_time" content="9009-09-07T918:44:21Z"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="9009-09-07T918:44:21Z"><meta property="article:published_time" content="9009-09-07T918:44:21Z"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Publish–subscribe Pattern","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2021-09-09","description":"","wordCount":"609","mainEntityOfPage":"True","dateModified":"2021-09-09","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/cancellation-token-in-dotnet-core/>CancellationToken in .NET Core</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/the-problem-with-async-void-in-asp-dotnet-core/>The Problem With `async void` in ASP.NET Core</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/testing-in-asp-dotnet-core-using-xunit/>Testing in ASP.NET Core Using xUnit</a></li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/api-versioning-in-asp-dotnet-core/>API Versioning in ASP.NET Core</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/advanced-server-rendering-react-query-with-nextjs-app-router/>Advanced Server Rendering: React Query With Next.js App Router</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2024 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/design-patterns/microservices/publishsubscribe-pattern/>Publish–subscribe Pattern</a></h1><time datetime=2021-09-09T19:18:44Z class=post-date>September 9, 2021</time><ul class=tags><li class=tag-Microservices><a href=https://gosang.github.io/tags/microservices>Microservices</a></li><li class=tag-Messaging><a href=https://gosang.github.io/tags/messaging>Messaging</a></li></ul><p class=seriesname>Series: <a href=https://gosang.github.io/series/design-patterns>Design Patterns</a></p></div><p>The Publish–Subscribe pattern, a stalwart in the realm of messaging patterns, orchestrates communication between components in a decoupled manner. Here, publishers categorize messages into topics and broadcast them without knowing the identity of subscribers. Subscribers express interest in specific topics, receiving messages related to those topics. Let&rsquo;s look into the intricacies of this pattern, exploring its rationale, problem-solving capabilities, and its implementation in the context of a .NET Core e-commerce system.</p><h2 id=the-rationale-behind-publishsubscribe>The Rationale Behind Publish–Subscribe</h2><p>The crux of the Publish–Subscribe pattern lies in fostering loose coupling among system components. By obviating direct dependencies, components can evolve independently, promoting modularity and scalability. The pattern excels in scenarios where flexibility and adaptability are paramount.</p><h2 id=problems-resolved-by-publishsubscribe>Problems Resolved by Publish–Subscribe</h2><ul><li><strong>Decoupling Components</strong>: Mitigates direct dependencies, allowing components to evolve autonomously.</li><li><strong>Scalability</strong>: Facilitates horizontal scaling, accommodating a growing number of publishers and subscribers.</li><li><strong>Flexibility</strong>: Enables seamless addition or removal of components without disrupting the entire system.</li></ul><h1 id=implementation-in-net-core-e-commerce-system>Implementation in .NET Core E-commerce System</h1><h2 id=setting-the-stage-net-core-services-and-apis>Setting the Stage: .NET Core Services and APIs</h2><p>Our e-commerce system leverages .NET Core, with services and APIs orchestrated by the MediatR library for CQRS, AutoMapper for object mapping, EF Core InMemory database, and xUnit for robust unit testing.</p><h4 id=1-mediatr-request-and-handler>1. MediatR Request and Handler</h4><p>Install the MediatR NuGet package:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package MediatR
</span></span></code></pre></div><p>Create a MediatR request and handler for handling order placements:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// OrderPlacedNotification.cs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderPlacedNotification</span> : INotification
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> OrderId { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// OrderPlacedNotificationHandler.cs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderPlacedNotificationHandler</span> : INotificationHandler&lt;OrderPlacedNotification&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task Handle(OrderPlacedNotification notification, CancellationToken cancellationToken)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Logic to handle the order placed notification</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=2-utilizing-publishsubscribe-in-e-commerce-services>2. Utilizing Publish–Subscribe in E-commerce Services</h4><p>In the Order Service, use MediatR to publish the OrderPlacedNotification upon order placement:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>// OrderService.cs</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderService</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IMediator _mediator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> OrderService(IMediator mediator)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        _mediator = mediator;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task PlaceOrder(Order order)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Logic to place an order</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Publish the OrderPlacedNotification</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> _mediator.Publish(<span style=color:#66d9ef>new</span> OrderPlacedNotification { OrderId = order.Id });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=3-docker-compose-for-local-deployment>3. Docker Compose for Local Deployment</h4><p>Compose your services using Docker Compose for local deployment:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.8&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>order-service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>order-service-image</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Add other configurations for the order service</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>notification-service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>notification-service-image</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Add other configurations for the notification service</span>
</span></span></code></pre></div><p>Run your services locally using:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up --build
</span></span></code></pre></div><h1 id=advantages-and-disadvantages>Advantages and Disadvantages</h1><h2 id=advantages>Advantages</h2><ul><li><strong>Loose Coupling</strong>: Components operate independently, allowing for modular development.</li><li><strong>Scalability</strong>: Scales horizontally to accommodate a growing number of components.</li><li><strong>Flexibility</strong>: Simplifies addition or removal of components without system-wide impact.</li></ul><h2 id=disadvantages>Disadvantages</h2><ul><li><strong>Complexity</strong>: Managing multiple topics can be intricate.</li><li><strong>Debugging</strong>: Indirect communication makes debugging challenging.</li></ul><h1 id=issues-and-considerations>Issues and Considerations</h1><ul><li><strong>Topic Management</strong>: Clearly define and document topics to avoid communication mismatches.</li><li><strong>Error Handling</strong>: Implement robust error handling to manage failures in publishing or subscribing.</li><li><strong>Debugging Challenges</strong>: Debugging can be challenging due to the indirect nature of communication.</li></ul><h1 id=when-to-use-publishsubscribe>When to Use Publish–Subscribe</h1><ul><li><strong>Scalability is a Concern</strong>: When a system needs to scale horizontally with ease.</li><li><strong>Components Need Independence</strong>: In scenarios where independent evolution of components is crucial.</li><li><strong>Event-Driven Architecture</strong>: When events trigger actions across different parts of the system.</li></ul><h1 id=when-not-to-use-publishsubscribe>When Not to Use Publish–Subscribe</h1><ul><li><strong>Simple Systems</strong>: For small, straightforward systems without a need for extensive scalability or flexibility.</li><li><strong>Tight Component Coupling</strong>: When components require direct and tightly-coupled communication.</li></ul><h1 id=best-practices>Best Practices</h1><ul><li><strong>Clearly Defined Topics</strong>: Document topics to ensure seamless communication.</li><li><strong>Error Handling</strong>: Implement robust error handling mechanisms.</li><li><strong>Monitoring and Logging</strong>: Integrate monitoring and logging for enhanced visibility.</li></ul><p>In conclusion, the Publish–Subscribe pattern emerges as a potent tool in the microservices arsenal. Leveraging its capabilities in a .NET Core e-commerce system brings forth a resilient and scalable architecture, paving the way for flexible and independent component evolution.</p><h1 id=references>References:</h1><ul><li><a href=https://github.com/jbogard/MediatR target=_blank>MediatR Documentation</a></li><li><a href=https://docs.docker.com/compose/ target=_blank>Docker Compose Documentation</a></li><li><a href=https://code.visualstudio.com/docs/containers/debug-common target=_blank>Visual Studio Code Debugging with Docker</a></li></ul><hr><div class=footer><p>This is a post in the <b><a href=https://gosang.github.io/series/design-patterns>Design Patterns</a></b> series.<br>Other posts in this series:<ul class=series><li>July 10, 2023 -
<a href=/posts/design-patterns/microservices/applying-outbox-pattern/>Applying the Outbox Design Pattern</a></li><li>June 22, 2023 -
<a href=/posts/design-patterns/object-oriented/grasp/>General Responsibility Assignment Software Patterns (GRASP)</a></li><li>April 30, 2023 -
<a href=/posts/design-patterns/microservices/outbox-pattern/>Outbox Pattern</a></li><li>April 9, 2023 -
<a href=/posts/design-patterns/microservices/strangler-pattern/>Strangler Pattern</a></li><li>March 18, 2023 -
<a href=/posts/design-patterns/event-sourcing-pattern/>Event Sourcing Design Pattern</a></li><li>March 1, 2023 -
<a href=/posts/design-patterns/command-query-responsibility-segregation/>Command Query Responsibility Segregation (CQRS)</a></li><li>February 12, 2022 -
<a href=/posts/design-patterns/repository-unit-of-work/>Repository Unit of Work</a></li><li>January 29, 2022 -
<a href=/posts/design-patterns/repository-pattern/>Repository Pattern</a></li><li>October 30, 2021 -
<a href=/posts/design-patterns/microservices/saga-patterns/>Saga Patterns</a></li><li>September 9, 2021 -
Publish–subscribe Pattern</li><li>January 23, 2021 -
<a href=/posts/design-patterns/null-object-pattern/>Null Object Pattern</a></li></ul></p></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#the-rationale-behind-publishsubscribe>The Rationale Behind Publish–Subscribe</a></li><li><a href=#problems-resolved-by-publishsubscribe>Problems Resolved by Publish–Subscribe</a></li></ul><ul><li><a href=#setting-the-stage-net-core-services-and-apis>Setting the Stage: .NET Core Services and APIs</a><ul><li></li></ul></li></ul><ul><li><a href=#advantages>Advantages</a></li><li><a href=#disadvantages>Disadvantages</a></li></ul></nav></div></div></div></body></html>