<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><script defer language=javascript type=text/javascript src=/js/bundle.min.11d62625e7495f8147fccf5d08f37bded574a50c4508c235cc666848567d99ab.js></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=/favicon.png><title itemprop=name>Go Sang - Implementing Cookie-Based Stateless Sessions in Next.js Using Server Actions</title><meta property="og:title" content="Go Sang - Implementing Cookie-Based Stateless Sessions in Next.js Using Server Actions"><meta name=twitter:title content="Go Sang - Implementing Cookie-Based Stateless Sessions in Next.js Using Server Actions"><meta itemprop=name content="Go Sang - Implementing Cookie-Based Stateless Sessions in Next.js Using Server Actions"><meta name=application-name content="Go Sang - Implementing Cookie-Based Stateless Sessions in Next.js Using Server Actions"><meta property="og:site_name" content><meta name=description content><meta itemprop=description content><meta property="og:description" content><meta name=twitter:description content><base href=https://gosang.github.io/posts/react/implementing-cookie-based-stateless-sessions-in-next-js-using-server-actions/><link rel=canonical href=https://gosang.github.io/posts/react/implementing-cookie-based-stateless-sessions-in-next-js-using-server-actions/ itemprop=url><meta name=url content="https://gosang.github.io/posts/react/implementing-cookie-based-stateless-sessions-in-next-js-using-server-actions/"><meta name=twitter:url content="https://gosang.github.io/posts/react/implementing-cookie-based-stateless-sessions-in-next-js-using-server-actions/"><meta property="og:url" content="https://gosang.github.io/posts/react/implementing-cookie-based-stateless-sessions-in-next-js-using-server-actions/"><meta property="og:updated_time" content="18008-18-12T844:19:24+0100"><link rel=sitemap type=application/xml title=Sitemap href=https://gosang.github.io/sitemap.xml><meta name=robots content="index,follow"><meta name=googlebot content="index,follow"><meta name=twitter:site content><meta name=twitter:creator content><meta property="fb:admins" content><meta name=apple-mobile-web-app-title content><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta property="og:type" content="article"><meta property="article:publisher" content><meta property="og:article:published_time" content="18008-18-12T844:19:24+0100"><meta property="article:published_time" content="18008-18-12T844:19:24+0100"><script defer type=application/ld+json>{"@context":"http://schema.org","@type":"Article","headline":"Implementing Cookie-Based Stateless Sessions in Next.js Using Server Actions","author":{"@type":"Person","name":"https:\/\/github.com\/gosang"},"datePublished":"2024-08-18","description":"","wordCount":"1067","mainEntityOfPage":"True","dateModified":"2024-08-18","image":{"@type":"imageObject","url":""},"publisher":{"@type":"Organization","name":"","logo":{"@type":"imageObject","url":""}}}</script><meta name=generator content="Hugo 0.119.0"><link type=text/css rel=stylesheet href=/css/bundle.min.178e339ccb9acabffeebf9adbb0bb23c1ec0b72a2a50edee18a5007d4d5a68aa.css><style>body{--sidebar-bg-color:#202020;--sidebar-img-border-color:#515151;--sidebar-p-color:#909090;--sidebar-h1-color:#FFF;--sidebar-a-color:#FFF;--sidebar-socials-color:#FFF;--text-color:#222;--bkg-color:#FAF9F6;--post-title-color:#303030;--list-color:#5a5a5a;--link-color:#268bd2;--date-color:#515151;--table-border-color:#E5E5E5;--table-stripe-color:#F9F9F9;--code-color:#bf616a;--code-background-color:#E5E5E5;--moon-sun-color:#FFF;--moon-sun-background-color:#515151}body.dark-theme{--text-color:#eee;--bkg-color:#121212;--post-title-color:#DBE2E9;--list-color:#9d9d9d;--link-color:#268bd2;--date-color:#9a9a9a;--table-border-color:#515151;--table-stripe-color:#202020;--code-color:#ff7f7f;--code-background-color:#393D47}body{background-color:var(--bkg-color)}</style></head><body><div class=wrapper><aside class=sidebar><div class="container sidebar-sticky"><div class=light-dark align=right><button class=btn-light-dark title="Toggle light/dark mode"><svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/></svg><svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16"><path fill="currentcolor" d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></svg></button></div><div class=sidebar-about><h1 class=brand><a href=https://gosang.github.io/><h1>Go Sang</h1></a></h1><p class=lead>Learning about technology.</p></div><nav><ul class=sidebar-nav><li class=heading><a href=/posts/>Posts</a></li><li class=sub-heading>Recent</li><li class=bullet><a href=https://gosang.github.io/posts/dotnet/implementing-pagination-with-mongodb-csharp-driver-in-asp-dotnet-core/>Implementing Pagination with MongoDB C# Driver in ASP.NET Core 8</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/zustand-redux-context-choosing-the-right-state-management-solution/>Zustand, Redux and Context: Choosing the Right State Management Solution</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/javascript-security-risks-and-best-practices-for-mitigation/>JavaScript Security Risks and Best Practices for Mitigation</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/understanding-memory-leaks-in-javascript-and-how-to-prevent-them/>Understanding Memory Leaks in JavaScript and How to Prevent Them</a></li><li class=bullet><a href=https://gosang.github.io/posts/react/error-handling-in-nextjs-with-typescript/>Error Handling in Next.js With TypeScript</a></li></ul></nav><a target=_blank class=social title=GitHub href=https://github.com/gosang><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24"><path fill="currentcolor" d="M18.88 1.099C18.147.366 17.265.0 16.233.0H3.746C2.714.0 1.832.366 1.099 1.099.366 1.832.0 2.714.0 3.746v12.487c0 1.032.366 1.914 1.099 2.647.733.733 1.615 1.099 2.647 1.099H6.66c.19.0.333-.007.429-.02a.504.504.0 00.286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555.0 01-.904-.091 2.026 2.026.0 01-.872-.39 1.651 1.651.0 01-.572-.8l-.13-.3a3.25 3.25.0 00-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956.0 01-.17-.156.723.723.0 01-.117-.182c-.026-.061-.004-.111.065-.15.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1.0 01.631.677c.2.355.44.626.722.813.282.186.566.28.852.28.286.0.533-.022.742-.065a2.59 2.59.0 00.585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907.0 01-1.333-.234 5.314 5.314.0 01-1.223-.507 3.5 3.5.0 01-1.047-.872c-.277-.347-.505-.802-.683-1.365-.177-.564-.266-1.215-.266-1.952.0-1.049.342-1.942 1.027-2.68-.32-.788-.29-1.673.091-2.652.252-.079.625-.02 1.119.175.494.195.856.362 1.086.5.23.14.414.257.553.352a9.233 9.233.0 012.497-.338c.859.0 1.691.113 2.498.338l.494-.312a6.997 6.997.0 011.197-.572c.46-.174.81-.221 1.054-.143.39.98.424 1.864.103 2.653.685.737 1.028 1.63 1.028 2.68.0.737-.089 1.39-.267 1.957-.177.568-.407 1.023-.689 1.366a3.65 3.65.0 01-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9.0 01-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36.0 00.208.189c.096.034.18.056.254.064.074.01.18.013.318.013h2.914c1.032.0 1.914-.366 2.647-1.099.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/></svg></a><a target=_blank class=social title="RSS Feed" href=https://gosang.github.io//posts/index.xml><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280 1280"><g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentcolor"><path d="M2295 11929c-284-12-642-45-707-65-17-5-18-63-18-1039 0-569 4-1036 8-1039 5-3 74 6 153 19 510 86 1168 95 1789 25 1348-153 2602-677 3670-1531 385-308 820-744 1126-1129 842-1060 1362-2313 1514-3650 70-621 61-1279-25-1789-13-79-22-148-19-153 3-4 471-8 1039-8h1035l5 23c51 225 85 942 67 1419-23 605-77 1044-198 1617-294 14e2-927 2734-1823 3846-1043 1295-2364 2259-3909 2854-1158 447-2451 656-3707 6e2z"/><path d="M2255 7845c-269-25-620-81-667-106-17-9-18-55-18-899 0-706 3-890 13-890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207-107 2267-823 2814-1902 166-327 268-637 330-1001 38-227 48-384 42-662-8-348-44-590-126-831-23-66-41-126-41-132 0-10 184-13 890-13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782-59 703-233 1323-545 1945-481 956-1313 1788-2270 2268-620 310-1239 483-1940 542-165 14-669 10-840-5z"/><path d="M2519 3815c-391-66-725-336-868-703-79-201-96-462-45-677 83-344 338-641 666-774 116-47 205-69 330-80 412-39 811 153 1040 5e2 193 292 240 648 128 981-135 403-492 699-914 757-1e2 14-241 12-337-4z"/></g></svg></a><p class=footnote>powered by <a target=_blank href=https://gohugo.io>Hugo</a> | themed with <a target=_blank href=https://github.com/lukeorth/poison>poison</a><br>&copy; 2025 . All rights reserved.</p></div></aside><main class="content container"><div class=post><div class=info><h1 class=post-title><a href=https://gosang.github.io/posts/react/implementing-cookie-based-stateless-sessions-in-next-js-using-server-actions/>Implementing Cookie-Based Stateless Sessions in Next.js Using Server Actions</a></h1><time datetime=2024-08-18T12:44:19+0100 class=post-date>August 18, 2024</time><ul class=tags><li class=tag-Next.js><a href=https://gosang.github.io/tags/next.js>Next.js</a></li><li class=tag-SSR><a href=https://gosang.github.io/tags/ssr>SSR</a></li><li class="tag-Cookie Sessions"><a href=https://gosang.github.io/tags/cookie-sessions>Cookie Sessions</a></li></ul></div><h1 id=introduction>Introduction</h1><p>In modern web development, managing user sessions efficiently and securely is crucial. One approach is to use cookie-based stateless sessions. This method leverages cookies to store session data client-side, reducing server-side complexity and improving scalability. In this blog post, we&rsquo;ll explore how to implement cookie-based stateless sessions in a Next.js application using Server Actions, focusing on managing user settings like theme preferences.</p><h1 id=what-is-cookie-based-stateless-session>What is Cookie-Based Stateless Session?</h1><p>A cookie-based stateless session involves storing session data in cookies, allowing the server to remain stateless. Each request from the client includes the session data, which the server can validate and use without needing to maintain session state between requests. This approach is particularly beneficial for scaling applications, as it eliminates the need for server-side session storage.</p><h1 id=why-cookie-based-stateless-session>Why Cookie-Based Stateless Session?</h1><p>Using cookie-based stateless sessions in Next.js with Server Actions provides several benefits:</p><ul><li><strong>Scalability</strong>: No need for centralized session storage, reducing server load.</li><li><strong>Performance</strong>: Faster request processing since session data is sent with each request.</li><li><strong>Simplicity</strong>: Simplifies backend logic by offloading session management to the client.</li></ul><h1 id=key-concepts>Key Concepts</h1><h2 id=cookies>Cookies</h2><p>Cookies are small pieces of data stored on the client&rsquo;s browser. They can be used to persist user sessions, preferences, and other stateful information.</p><h2 id=stateless-sessions>Stateless Sessions</h2><p>In a stateless session, the server does not maintain any session information. Each request is self-contained and carries all the necessary data for the server to process it.</p><h2 id=server-actions>Server Actions</h2><p>Server Actions in Next.js allow you to perform server-side logic as part of your application&rsquo;s data fetching and handling flow. They are useful for handling operations that require server-side validation or data manipulation.</p><h1 id=key-functions>Key Functions</h1><ul><li><strong>Setting Cookies</strong>: Use set-cookie headers to store session data.</li><li><strong>Reading Cookies</strong>: Parse cookies from incoming requests to retrieve session data.</li><li><strong>Server Actions</strong>: Handle server-side logic and data processing.</li></ul><h1 id=a-sample-implementation>A Sample Implementation</h1><p>Let&rsquo;s create a sample Next.js project to demonstrate a cookie-based stateless session that stores and retrieves user settings like theme preferences.</p><h2 id=step-1-setup-nextjs-project>Step 1: Setup Next.js Project</h2><p>Create a new Next.js project:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npx create-next-app@latest my-nextjs-app
</span></span><span style=display:flex><span>cd my-nextjs-app
</span></span></code></pre></div><p>Install necessary dependencies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install cookie
</span></span><span style=display:flex><span>npm install typescript @types/node @types/react --save-dev
</span></span></code></pre></div><h2 id=step-2-create-utility-functions-for-cookies>Step 2: Create Utility Functions for Cookies</h2><p>Create a utility file lib/cookies.ts to handle cookie operations.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// lib/cookies.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>NextApiResponse</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>parse</span>, <span style=color:#a6e22e>serialize</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;cookie&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>COOKIE_NAME</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;user-settings&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>setCookie</span> <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>: <span style=color:#66d9ef>NextApiResponse</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span>: <span style=color:#66d9ef>string</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>options</span>: <span style=color:#66d9ef>any</span> <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>stringValue</span> <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;object&#34;</span> <span style=color:#f92672>?</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>stringify</span>(<span style=color:#a6e22e>value</span>) <span style=color:#f92672>:</span> String(<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>serializedCookie</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>serialize</span>(<span style=color:#a6e22e>COOKIE_NAME</span>, <span style=color:#a6e22e>stringValue</span>, {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>httpOnly</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>secure</span>: <span style=color:#66d9ef>process.env.NODE_ENV</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;production&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxAge</span>: <span style=color:#66d9ef>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>24</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>30</span>, <span style=color:#75715e>// 30 days
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/&#34;</span>,
</span></span><span style=display:flex><span>    ...<span style=color:#a6e22e>options</span>,
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#34;Set-Cookie&#34;</span>, <span style=color:#a6e22e>serializedCookie</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>getCookie</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>req</span>: <span style=color:#66d9ef>any</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cookies</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>headers</span>.<span style=color:#a6e22e>cookie</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>cookies</span>[<span style=color:#a6e22e>COOKIE_NAME</span>] <span style=color:#f92672>?</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>cookies</span>[<span style=color:#a6e22e>COOKIE_NAME</span>]) <span style=color:#f92672>:</span> {};
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h2 id=step-3-implement-server-action-to-set-and-get-theme>Step 3: Implement Server Action to Set and Get Theme</h2><p>Create a new API route pages/api/settings.ts to handle user settings.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// pages/api/settings.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>NextApiRequest</span>, <span style=color:#a6e22e>NextApiResponse</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>getCookie</span>, <span style=color:#a6e22e>setCookie</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../../lib/cookies&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handler</span>(<span style=color:#a6e22e>req</span>: <span style=color:#66d9ef>NextApiRequest</span>, <span style=color:#a6e22e>res</span>: <span style=color:#66d9ef>NextApiResponse</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>method</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;POST&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>theme</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>body</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setCookie</span>(<span style=color:#a6e22e>res</span>, { <span style=color:#a6e22e>theme</span> });
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>200</span>).<span style=color:#a6e22e>json</span>({ <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;Settings saved&#34;</span> });
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>method</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;GET&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>settings</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>getCookie</span>(<span style=color:#a6e22e>req</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>200</span>).<span style=color:#a6e22e>json</span>(<span style=color:#a6e22e>settings</span>);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#34;Allow&#34;</span>, [<span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;POST&#34;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>res</span>.<span style=color:#a6e22e>status</span>(<span style=color:#ae81ff>405</span>).<span style=color:#a6e22e>end</span>(<span style=color:#e6db74>`Method </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>req</span>.<span style=color:#a6e22e>method</span><span style=color:#e6db74>}</span><span style=color:#e6db74> Not Allowed`</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=step-4-create-a-theme-context>Step 4: Create a Theme Context</h2><p>Create a context to manage theme settings in context/ThemeContext.tsx.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// context/ThemeContext.tsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createContext</span>, <span style=color:#a6e22e>useContext</span>, <span style=color:#a6e22e>useEffect</span>, <span style=color:#a6e22e>useState</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;react&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ThemeContext</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createContext</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>theme</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;light&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>setTheme</span><span style=color:#f92672>:</span> (<span style=color:#a6e22e>theme</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> {},
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ThemeProvider</span> <span style=color:#f92672>=</span> ({ <span style=color:#a6e22e>children</span> }<span style=color:#f92672>:</span> { <span style=color:#a6e22e>children</span>: <span style=color:#66d9ef>React.ReactNode</span> }) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> [<span style=color:#a6e22e>theme</span>, <span style=color:#a6e22e>setTheme</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>useState</span>(<span style=color:#e6db74>&#34;light&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>useEffect</span>(() <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fetchSettings</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;/api/settings&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>json</span>();
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>theme</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>setTheme</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>theme</span>);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fetchSettings</span>();
</span></span><span style=display:flex><span>  }, []);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>saveTheme</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>async</span> (<span style=color:#a6e22e>newTheme</span>: <span style=color:#66d9ef>string</span>) <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setTheme</span>(<span style=color:#a6e22e>newTheme</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;/api/settings&#34;</span>, {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>headers</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>body</span>: <span style=color:#66d9ef>JSON.stringify</span>({ <span style=color:#a6e22e>theme</span>: <span style=color:#66d9ef>newTheme</span> }),
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>ThemeContext.Provider</span> <span style=color:#a6e22e>value</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>theme</span>, <span style=color:#a6e22e>setTheme</span>: <span style=color:#66d9ef>saveTheme</span> }}&gt;
</span></span><span style=display:flex><span>      {<span style=color:#a6e22e>children</span>}
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>ThemeContext.Provider</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>useTheme</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> <span style=color:#a6e22e>useContext</span>(<span style=color:#a6e22e>ThemeContext</span>);
</span></span></code></pre></div><h2 id=step-5-integrate-theme-context-in-application>Step 5: Integrate Theme Context in Application</h2><p>Wrap your application with the ThemeProvider in pages/_app.tsx.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// pages/_app.tsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>AppProps</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;next/app&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ThemeProvider</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../context/ThemeContext&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>MyApp</span>({ <span style=color:#a6e22e>Component</span>, <span style=color:#a6e22e>pageProps</span> }<span style=color:#f92672>:</span> <span style=color:#a6e22e>AppProps</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>ThemeProvider</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Component</span> {<span style=color:#a6e22e>...pageProps</span>} /&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>ThemeProvider</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>MyApp</span>;
</span></span></code></pre></div><h2 id=step-6-create-theme-toggle-component>Step 6: Create Theme Toggle Component</h2><p>Create a component to toggle between light and dark themes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// components/ThemeToggle.tsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>useTheme</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../context/ThemeContext&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ThemeToggle</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>theme</span>, <span style=color:#a6e22e>setTheme</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>useTheme</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>toggleTheme</span> <span style=color:#f92672>=</span> () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>setTheme</span>(<span style=color:#a6e22e>theme</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;light&#34;</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;dark&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;light&#34;</span>);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>button</span> <span style=color:#a6e22e>onClick</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>toggleTheme</span>}&gt;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Toggle</span> <span style=color:#a6e22e>to</span> {<span style=color:#a6e22e>theme</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;light&#34;</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;dark&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;light&#34;</span>} <span style=color:#a6e22e>theme</span>
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>ThemeToggle</span>;
</span></span></code></pre></div><h2 id=step-7-use-theme-toggle-in-a-page>Step 7: Use Theme Toggle in a Page</h2><p>Use the ThemeToggle component in your index.tsx page.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// pages/index.tsx
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>ThemeToggle</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;../components/ThemeToggle&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Home() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>h1</span>&gt;<span style=color:#a6e22e>Welcome</span> <span style=color:#a6e22e>to</span> <span style=color:#a6e22e>Next</span>.<span style=color:#a6e22e>js</span> <span style=color:#66d9ef>with</span> <span style=color:#a6e22e>Cookie</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Based</span> <span style=color:#a6e22e>Stateless</span> <span style=color:#a6e22e>Session</span>&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>ThemeToggle</span> /&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=advantages-and-disadvantages>Advantages and Disadvantages</h1><table><thead><tr><th>Advantages</th><th>Disadvantages</th></tr></thead><tbody><tr><td><strong>Scalability</strong>: No need for server-side session storage.</td><td><strong>Security</strong>: Requires careful handling to prevent vulnerabilities like XSS and CSRF.</td></tr><tr><td><strong>Performance</strong>: Reduces server processing time.</td><td><strong>Storage Limitations</strong>: Limited by cookie size constraints (typically 4KB).</td></tr><tr><td><strong>Simplicity</strong>: Easier to manage without centralized session management.</td><td></td></tr></tbody></table><h1 id=when-to-use>When to Use</h1><table><thead><tr><th>When to use</th><th>When not to use</th></tr></thead><tbody><tr><td><strong>Highly Scalable Applications</strong>: Where maintaining server-side session storage is impractical.</td><td><strong>Sensitive Data</strong>: Avoid storing sensitive information in cookies.</td></tr><tr><td><strong>Simple Session Data</strong>: Suitable for lightweight session data like user preferences.</td><td><strong>Complex Session Data</strong>: If the session data is large or complex, server-side storage might be more appropriate.</td></tr></tbody></table><h1 id=issues-considerations-and-best-practices>Issues, Considerations, and Best Practices</h1><h2 id=security>Security</h2><ul><li><strong>HTTPOnly and Secure Flags</strong>: Use these flags to prevent client-side scripts from accessing the cookies.</li><li><strong>Encryption</strong>: Consider encrypting cookie data to enhance security.</li></ul><h2 id=performance>Performance</h2><ul><li><strong>Cookie Size</strong>: Keep the cookie size small to avoid performance issues.</li><li><strong>Cache-Control</strong>: Ensure proper cache control to prevent stale data.</li></ul><h2 id=best-practices>Best Practices</h2><ul><li><strong>Validation</strong>: Always validate and sanitize data stored in cookies.</li><li><strong>Expiry</strong>: Set appropriate expiry times for cookies to manage session duration.</li></ul><h1 id=conclusion>Conclusion</h1><p>Implementing cookie-based stateless sessions in Next.js using Server Actions can significantly enhance the scalability and performance of your application. By following the outlined steps and best practices, you can efficiently manage user settings and other lightweight session data securely. This approach is especially beneficial for applications requiring high scalability and simple session management.</p><hr><div class=footer><a class=previous-post href="https://gosang.github.io/posts/dotnet/sending-email-in-asp-dotnet-core-with-microsoft-graph/?ref=footer"><span style=font-weight:700>« Previous</span><br>Sending Email in ASP.NET Core With Microsoft Graph</a><div class=next-post><a href="https://gosang.github.io/posts/dotnet/sending-emails-in-asp-dotnet-core-with-aws-simple-email-service/?ref=footer"><span style=font-weight:700>Next »</span><br>Sending Emails in ASP.NET Core With AWS Simple...</a></div></div></div></main><div class=article-toc><div class=toc-wrapper><h4 id=contents></h4><nav id=TableOfContents><ul><li><a href=#cookies>Cookies</a></li><li><a href=#stateless-sessions>Stateless Sessions</a></li><li><a href=#server-actions>Server Actions</a></li></ul><ul><li><a href=#step-1-setup-nextjs-project>Step 1: Setup Next.js Project</a></li><li><a href=#step-2-create-utility-functions-for-cookies>Step 2: Create Utility Functions for Cookies</a></li><li><a href=#step-3-implement-server-action-to-set-and-get-theme>Step 3: Implement Server Action to Set and Get Theme</a></li><li><a href=#step-4-create-a-theme-context>Step 4: Create a Theme Context</a></li><li><a href=#step-5-integrate-theme-context-in-application>Step 5: Integrate Theme Context in Application</a></li><li><a href=#step-6-create-theme-toggle-component>Step 6: Create Theme Toggle Component</a></li><li><a href=#step-7-use-theme-toggle-in-a-page>Step 7: Use Theme Toggle in a Page</a></li></ul><ul><li><a href=#security>Security</a></li><li><a href=#performance>Performance</a></li><li><a href=#best-practices>Best Practices</a></li></ul></nav></div></div></div></body></html>